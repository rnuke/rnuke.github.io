!function(e,t,r,n,s){var i="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof self?self:"undefined"!=typeof window?window:"undefined"!=typeof global?global:{},a="function"==typeof i.parcelRequirebbb8&&i.parcelRequirebbb8,o=a.cache||{},c="undefined"!=typeof module&&"function"==typeof module.require&&module.require.bind(module);function u(t,r){if(!o[t]){if(!e[t]){var n="function"==typeof i.parcelRequirebbb8&&i.parcelRequirebbb8;if(!r&&n)return n(t,!0);if(a)return a(t,!0);if(c&&"string"==typeof t)return c(t);var s=new Error("Cannot find module '"+t+"'");throw s.code="MODULE_NOT_FOUND",s}h.resolve=function(r){var n=e[t][1][r];return null!=n?n:r},h.cache={};var l=o[t]=new u.Module(t);e[t][0].call(l.exports,h,l,l.exports,this)}return o[t].exports;function h(e){var t=h.resolve(e);return!1===t?{}:u(t)}}u.isParcelRequire=!0,u.Module=function(e){this.id=e,this.bundle=u,this.exports={}},u.modules=e,u.cache=o,u.parent=a,u.register=function(t,r){e[t]=[function(e,t){t.exports=r},{}]},Object.defineProperty(u,"root",{get:function(){return i.parcelRequirebbb8}}),i.parcelRequirebbb8=u;for(var l=0;l<t.length;l++)u(t[l]);var h=u(r);"object"==typeof exports&&"undefined"!=typeof module?module.exports=h:"function"==typeof define&&define.amd&&define((function(){return h}))}({b4ts6:[function(e,t,r){var n=e("@parcel/transformer-js/src/esmodule-helpers.js"),s=e("@hotwired/stimulus"),i=e("./controllers/authorize_controller"),a=n.interopDefault(i),o=e("./controllers/nuke_controller"),c=n.interopDefault(o);window.Stimulus=s.Application.start(),Stimulus.register("authorize",a.default),Stimulus.register("nuke",c.default)},{"@hotwired/stimulus":"51pPy","./controllers/authorize_controller":"2Z9zf","./controllers/nuke_controller":"bRnoY","@parcel/transformer-js/src/esmodule-helpers.js":"3ieD1"}],"51pPy":[function(e,t,r){var n=e("@parcel/transformer-js/src/esmodule-helpers.js");n.defineInteropFlag(r),n.export(r,"Application",(function(){return _e})),n.export(r,"AttributeObserver",(function(){return K})),n.export(r,"Context",(function(){return ee})),n.export(r,"Controller",(function(){return De})),n.export(r,"ElementObserver",(function(){return q})),n.export(r,"IndexedMultimap",(function(){return J})),n.export(r,"Multimap",(function(){return U})),n.export(r,"StringMapObserver",(function(){return V})),n.export(r,"TokenListObserver",(function(){return Y})),n.export(r,"ValueListObserver",(function(){return Q})),n.export(r,"add",(function(){return G})),n.export(r,"defaultSchema",(function(){return me})),n.export(r,"del",(function(){return z})),n.export(r,"fetch",(function(){return H})),n.export(r,"prune",(function(){return W}));var s=e("@swc/helpers/src/_async_to_generator.mjs"),i=n.interopDefault(s),a=e("@swc/helpers/src/_class_call_check.mjs"),o=n.interopDefault(a),c=e("@swc/helpers/src/_create_class.mjs"),u=n.interopDefault(c),l=e("@swc/helpers/src/_define_property.mjs"),h=n.interopDefault(l),f=e("@swc/helpers/src/_get.mjs"),d=n.interopDefault(f),p=e("@swc/helpers/src/_get_prototype_of.mjs"),v=n.interopDefault(p),m=e("@swc/helpers/src/_inherits.mjs"),_=n.interopDefault(m),y=e("@swc/helpers/src/_sliced_to_array.mjs"),g=n.interopDefault(y),k=e("@swc/helpers/src/_to_consumable_array.mjs"),b=n.interopDefault(k),w=e("@swc/helpers/src/_type_of.mjs"),j=n.interopDefault(w),x=e("@swc/helpers/src/_create_super.mjs"),D=n.interopDefault(x),E=e("regenerator-runtime"),O=n.interopDefault(E),A=function(){"use strict";function e(t,r,n){(0,o.default)(this,e),this.eventTarget=t,this.eventName=r,this.eventOptions=n,this.unorderedBindings=new Set}return(0,u.default)(e,[{key:"connect",value:function(){this.eventTarget.addEventListener(this.eventName,this,this.eventOptions)}},{key:"disconnect",value:function(){this.eventTarget.removeEventListener(this.eventName,this,this.eventOptions)}},{key:"bindingConnected",value:function(e){this.unorderedBindings.add(e)}},{key:"bindingDisconnected",value:function(e){this.unorderedBindings.delete(e)}},{key:"handleEvent",value:function(e){var t=function(e){if("immediatePropagationStopped"in e)return e;var t=e.stopImmediatePropagation;return Object.assign(e,{immediatePropagationStopped:!1,stopImmediatePropagation:function(){this.immediatePropagationStopped=!0,t.call(this)}})}(e),r=!0,n=!1,s=void 0;try{for(var i,a=this.bindings[Symbol.iterator]();!(r=(i=a.next()).done);r=!0){var o=i.value;if(t.immediatePropagationStopped)break;o.handleEvent(t)}}catch(e){n=!0,s=e}finally{try{r||null==a.return||a.return()}finally{if(n)throw s}}}},{key:"bindings",get:function(){return Array.from(this.unorderedBindings).sort((function(e,t){var r=e.index,n=t.index;return r<n?-1:r>n?1:0}))}}]),e}();var R=function(){"use strict";function e(t){(0,o.default)(this,e),this.application=t,this.eventListenerMaps=new Map,this.started=!1}return(0,u.default)(e,[{key:"start",value:function(){this.started||(this.started=!0,this.eventListeners.forEach((function(e){return e.connect()})))}},{key:"stop",value:function(){this.started&&(this.started=!1,this.eventListeners.forEach((function(e){return e.disconnect()})))}},{key:"eventListeners",get:function(){return Array.from(this.eventListenerMaps.values()).reduce((function(e,t){return e.concat(Array.from(t.values()))}),[])}},{key:"bindingConnected",value:function(e){this.fetchEventListenerForBinding(e).bindingConnected(e)}},{key:"bindingDisconnected",value:function(e){this.fetchEventListenerForBinding(e).bindingDisconnected(e)}},{key:"handleError",value:function(e,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};this.application.handleError(e,"Error ".concat(t),r)}},{key:"fetchEventListenerForBinding",value:function(e){var t=e.eventTarget,r=e.eventName,n=e.eventOptions;return this.fetchEventListener(t,r,n)}},{key:"fetchEventListener",value:function(e,t,r){var n=this.fetchEventListenerMapForEventTarget(e),s=this.cacheKey(t,r),i=n.get(s);return i||(i=this.createEventListener(e,t,r),n.set(s,i)),i}},{key:"createEventListener",value:function(e,t,r){var n=new A(e,t,r);return this.started&&n.connect(),n}},{key:"fetchEventListenerMapForEventTarget",value:function(e){var t=this.eventListenerMaps.get(e);return t||(t=new Map,this.eventListenerMaps.set(e,t)),t}},{key:"cacheKey",value:function(e,t){var r=[e];return Object.keys(t).sort().forEach((function(e){r.push("".concat(t[e]?"":"!").concat(e))})),r.join(":")}}]),e}(),C=/^((.+?)(@(window|document))?->)?(.+?)(#([^:]+?))(:(.+))?$/;function I(e){return"window"==e?window:"document"==e?document:void 0}function T(e){return e.replace(/(?:[_-])([a-z0-9])/g,(function(e,t){return t.toUpperCase()}))}function S(e){return e.charAt(0).toUpperCase()+e.slice(1)}function P(e){return e.replace(/([A-Z])/g,(function(e,t){return"-".concat(t.toLowerCase())}))}var L=function(){"use strict";function e(t,r,n){(0,o.default)(this,e),this.element=t,this.index=r,this.eventTarget=n.eventTarget||t,this.eventName=n.eventName||function(e){var t=e.tagName.toLowerCase();if(t in F)return F[t](e)}(t)||M("missing event name"),this.eventOptions=n.eventOptions||{},this.identifier=n.identifier||M("missing identifier"),this.methodName=n.methodName||M("missing method name")}return(0,u.default)(e,[{key:"toString",value:function(){var e=this.eventTargetName?"@".concat(this.eventTargetName):"";return"".concat(this.eventName).concat(e,"->").concat(this.identifier,"#").concat(this.methodName)}},{key:"params",get:function(){var e={},t=new RegExp("^data-".concat(this.identifier,"-(.+)-param$")),r=!0,n=!1,s=void 0;try{for(var i,a=Array.from(this.element.attributes)[Symbol.iterator]();!(r=(i=a.next()).done);r=!0){var o=i.value,c=o.name,u=o.value,l=c.match(t),h=l&&l[1];h&&(e[T(h)]=N(u))}}catch(e){n=!0,s=e}finally{try{r||null==a.return||a.return()}finally{if(n)throw s}}return e}},{key:"eventTargetName",get:function(){return(e=this.eventTarget)==window?"window":e==document?"document":void 0;var e}}],[{key:"forToken",value:function(e){return new this(e.element,e.index,(t=e.content,{eventTarget:I((n=t.trim().match(C)||[])[4]),eventName:n[2],eventOptions:n[9]?(r=n[9],r.split(":").reduce((function(e,t){return Object.assign(e,(0,h.default)({},t.replace(/^!/,""),!/^!/.test(t)))}),{})):{},identifier:n[5],methodName:n[7]}));var t,r,n}}]),e}(),F={a:function(e){return"click"},button:function(e){return"click"},form:function(e){return"submit"},details:function(e){return"toggle"},input:function(e){return"submit"==e.getAttribute("type")?"click":"input"},select:function(e){return"change"},textarea:function(e){return"input"}};function M(e){throw new Error(e)}function N(e){try{return JSON.parse(e)}catch(t){return e}}var B=function(){"use strict";function e(t,r){(0,o.default)(this,e),this.context=t,this.action=r}return(0,u.default)(e,[{key:"index",get:function(){return this.action.index}},{key:"eventTarget",get:function(){return this.action.eventTarget}},{key:"eventOptions",get:function(){return this.action.eventOptions}},{key:"identifier",get:function(){return this.context.identifier}},{key:"handleEvent",value:function(e){this.willBeInvokedByEvent(e)&&this.shouldBeInvokedPerSelf(e)&&(this.processStopPropagation(e),this.processPreventDefault(e),this.invokeWithEvent(e))}},{key:"eventName",get:function(){return this.action.eventName}},{key:"method",get:function(){var e=this.controller[this.methodName];if("function"==typeof e)return e;throw new Error('Action "'.concat(this.action,'" references undefined method "').concat(this.methodName,'"'))}},{key:"processStopPropagation",value:function(e){this.eventOptions.stop&&e.stopPropagation()}},{key:"processPreventDefault",value:function(e){this.eventOptions.prevent&&e.preventDefault()}},{key:"invokeWithEvent",value:function(e){var t=e.target,r=e.currentTarget;try{var n=this.action.params,s=Object.assign(e,{params:n});this.method.call(this.controller,s),this.context.logDebugActivity(this.methodName,{event:e,target:t,currentTarget:r,action:this.methodName})}catch(t){var i=this,a={identifier:i.identifier,controller:i.controller,element:i.element,index:i.index,event:e};this.context.handleError(t,'invoking action "'.concat(this.action,'"'),a)}}},{key:"shouldBeInvokedPerSelf",value:function(e){return!0!==this.action.eventOptions.self||this.action.element===e.target}},{key:"willBeInvokedByEvent",value:function(e){var t=e.target;return this.element===t||(t instanceof Element&&this.element.contains(t)?this.scope.containsElement(t):this.scope.containsElement(this.action.element))}},{key:"controller",get:function(){return this.context.controller}},{key:"methodName",get:function(){return this.action.methodName}},{key:"element",get:function(){return this.scope.element}},{key:"scope",get:function(){return this.context.scope}}]),e}(),q=function(){"use strict";function e(t,r){var n=this;(0,o.default)(this,e),this.mutationObserverInit={attributes:!0,childList:!0,subtree:!0},this.element=t,this.started=!1,this.delegate=r,this.elements=new Set,this.mutationObserver=new MutationObserver((function(e){return n.processMutations(e)}))}return(0,u.default)(e,[{key:"start",value:function(){this.started||(this.started=!0,this.mutationObserver.observe(this.element,this.mutationObserverInit),this.refresh())}},{key:"pause",value:function(e){this.started&&(this.mutationObserver.disconnect(),this.started=!1),e(),this.started||(this.mutationObserver.observe(this.element,this.mutationObserverInit),this.started=!0)}},{key:"stop",value:function(){this.started&&(this.mutationObserver.takeRecords(),this.mutationObserver.disconnect(),this.started=!1)}},{key:"refresh",value:function(){if(this.started){var e=new Set(this.matchElementsInTree()),t=!0,r=!1,n=void 0;try{for(var s,i=Array.from(this.elements)[Symbol.iterator]();!(t=(s=i.next()).done);t=!0){var a=s.value;e.has(a)||this.removeElement(a)}}catch(e){r=!0,n=e}finally{try{t||null==i.return||i.return()}finally{if(r)throw n}}var o=!0,c=!1,u=void 0;try{for(var l,h=Array.from(e)[Symbol.iterator]();!(o=(l=h.next()).done);o=!0){var f=l.value;this.addElement(f)}}catch(e){c=!0,u=e}finally{try{o||null==h.return||h.return()}finally{if(c)throw u}}}}},{key:"processMutations",value:function(e){var t=!0,r=!1,n=void 0;if(this.started)try{for(var s,i=e[Symbol.iterator]();!(t=(s=i.next()).done);t=!0){var a=s.value;this.processMutation(a)}}catch(e){r=!0,n=e}finally{try{t||null==i.return||i.return()}finally{if(r)throw n}}}},{key:"processMutation",value:function(e){"attributes"==e.type?this.processAttributeChange(e.target,e.attributeName):"childList"==e.type&&(this.processRemovedNodes(e.removedNodes),this.processAddedNodes(e.addedNodes))}},{key:"processAttributeChange",value:function(e,t){var r=e;this.elements.has(r)?this.delegate.elementAttributeChanged&&this.matchElement(r)?this.delegate.elementAttributeChanged(r,t):this.removeElement(r):this.matchElement(r)&&this.addElement(r)}},{key:"processRemovedNodes",value:function(e){var t=!0,r=!1,n=void 0;try{for(var s,i=Array.from(e)[Symbol.iterator]();!(t=(s=i.next()).done);t=!0){var a=s.value,o=this.elementFromNode(a);o&&this.processTree(o,this.removeElement)}}catch(e){r=!0,n=e}finally{try{t||null==i.return||i.return()}finally{if(r)throw n}}}},{key:"processAddedNodes",value:function(e){var t=!0,r=!1,n=void 0;try{for(var s,i=Array.from(e)[Symbol.iterator]();!(t=(s=i.next()).done);t=!0){var a=s.value,o=this.elementFromNode(a);o&&this.elementIsActive(o)&&this.processTree(o,this.addElement)}}catch(e){r=!0,n=e}finally{try{t||null==i.return||i.return()}finally{if(r)throw n}}}},{key:"matchElement",value:function(e){return this.delegate.matchElement(e)}},{key:"matchElementsInTree",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.element;return this.delegate.matchElementsInTree(e)}},{key:"processTree",value:function(e,t){var r=!0,n=!1,s=void 0;try{for(var i,a=this.matchElementsInTree(e)[Symbol.iterator]();!(r=(i=a.next()).done);r=!0){var o=i.value;t.call(this,o)}}catch(e){n=!0,s=e}finally{try{r||null==a.return||a.return()}finally{if(n)throw s}}}},{key:"elementFromNode",value:function(e){if(e.nodeType==Node.ELEMENT_NODE)return e}},{key:"elementIsActive",value:function(e){return e.isConnected==this.element.isConnected&&this.element.contains(e)}},{key:"addElement",value:function(e){this.elements.has(e)||this.elementIsActive(e)&&(this.elements.add(e),this.delegate.elementMatched&&this.delegate.elementMatched(e))}},{key:"removeElement",value:function(e){this.elements.has(e)&&(this.elements.delete(e),this.delegate.elementUnmatched&&this.delegate.elementUnmatched(e))}}]),e}(),K=function(){"use strict";function e(t,r,n){(0,o.default)(this,e),this.attributeName=r,this.delegate=n,this.elementObserver=new q(t,this)}return(0,u.default)(e,[{key:"element",get:function(){return this.elementObserver.element}},{key:"selector",get:function(){return"[".concat(this.attributeName,"]")}},{key:"start",value:function(){this.elementObserver.start()}},{key:"pause",value:function(e){this.elementObserver.pause(e)}},{key:"stop",value:function(){this.elementObserver.stop()}},{key:"refresh",value:function(){this.elementObserver.refresh()}},{key:"started",get:function(){return this.elementObserver.started}},{key:"matchElement",value:function(e){return e.hasAttribute(this.attributeName)}},{key:"matchElementsInTree",value:function(e){var t=this.matchElement(e)?[e]:[],r=Array.from(e.querySelectorAll(this.selector));return t.concat(r)}},{key:"elementMatched",value:function(e){this.delegate.elementMatchedAttribute&&this.delegate.elementMatchedAttribute(e,this.attributeName)}},{key:"elementUnmatched",value:function(e){this.delegate.elementUnmatchedAttribute&&this.delegate.elementUnmatchedAttribute(e,this.attributeName)}},{key:"elementAttributeChanged",value:function(e,t){this.delegate.elementAttributeValueChanged&&this.attributeName==t&&this.delegate.elementAttributeValueChanged(e,t)}}]),e}(),V=function(){"use strict";function e(t,r){var n=this;(0,o.default)(this,e),this.element=t,this.delegate=r,this.started=!1,this.stringMap=new Map,this.mutationObserver=new MutationObserver((function(e){return n.processMutations(e)}))}return(0,u.default)(e,[{key:"start",value:function(){this.started||(this.started=!0,this.mutationObserver.observe(this.element,{attributes:!0,attributeOldValue:!0}),this.refresh())}},{key:"stop",value:function(){this.started&&(this.mutationObserver.takeRecords(),this.mutationObserver.disconnect(),this.started=!1)}},{key:"refresh",value:function(){var e=!0,t=!1,r=void 0;if(this.started)try{for(var n,s=this.knownAttributeNames[Symbol.iterator]();!(e=(n=s.next()).done);e=!0){var i=n.value;this.refreshAttribute(i,null)}}catch(e){t=!0,r=e}finally{try{e||null==s.return||s.return()}finally{if(t)throw r}}}},{key:"processMutations",value:function(e){var t=!0,r=!1,n=void 0;if(this.started)try{for(var s,i=e[Symbol.iterator]();!(t=(s=i.next()).done);t=!0){var a=s.value;this.processMutation(a)}}catch(e){r=!0,n=e}finally{try{t||null==i.return||i.return()}finally{if(r)throw n}}}},{key:"processMutation",value:function(e){var t=e.attributeName;t&&this.refreshAttribute(t,e.oldValue)}},{key:"refreshAttribute",value:function(e,t){var r=this.delegate.getStringMapKeyForAttribute(e);if(null!=r){this.stringMap.has(e)||this.stringMapKeyAdded(r,e);var n=this.element.getAttribute(e);if(this.stringMap.get(e)!=n&&this.stringMapValueChanged(n,r,t),null==n){var s=this.stringMap.get(e);this.stringMap.delete(e),s&&this.stringMapKeyRemoved(r,e,s)}else this.stringMap.set(e,n)}}},{key:"stringMapKeyAdded",value:function(e,t){this.delegate.stringMapKeyAdded&&this.delegate.stringMapKeyAdded(e,t)}},{key:"stringMapValueChanged",value:function(e,t,r){this.delegate.stringMapValueChanged&&this.delegate.stringMapValueChanged(e,t,r)}},{key:"stringMapKeyRemoved",value:function(e,t,r){this.delegate.stringMapKeyRemoved&&this.delegate.stringMapKeyRemoved(e,t,r)}},{key:"knownAttributeNames",get:function(){return Array.from(new Set(this.currentAttributeNames.concat(this.recordedAttributeNames)))}},{key:"currentAttributeNames",get:function(){return Array.from(this.element.attributes).map((function(e){return e.name}))}},{key:"recordedAttributeNames",get:function(){return Array.from(this.stringMap.keys())}}]),e}();function G(e,t,r){H(e,t).add(r)}function z(e,t,r){H(e,t).delete(r),W(e,t)}function H(e,t){var r=e.get(t);return r||(r=new Set,e.set(t,r)),r}function W(e,t){var r=e.get(t);null!=r&&0==r.size&&e.delete(t)}var U=function(){"use strict";function e(){(0,o.default)(this,e),this.valuesByKey=new Map}return(0,u.default)(e,[{key:"keys",get:function(){return Array.from(this.valuesByKey.keys())}},{key:"values",get:function(){return Array.from(this.valuesByKey.values()).reduce((function(e,t){return e.concat(Array.from(t))}),[])}},{key:"size",get:function(){return Array.from(this.valuesByKey.values()).reduce((function(e,t){return e+t.size}),0)}},{key:"add",value:function(e,t){G(this.valuesByKey,e,t)}},{key:"delete",value:function(e,t){z(this.valuesByKey,e,t)}},{key:"has",value:function(e,t){var r=this.valuesByKey.get(e);return null!=r&&r.has(t)}},{key:"hasKey",value:function(e){return this.valuesByKey.has(e)}},{key:"hasValue",value:function(e){return Array.from(this.valuesByKey.values()).some((function(t){return t.has(e)}))}},{key:"getValuesForKey",value:function(e){var t=this.valuesByKey.get(e);return t?Array.from(t):[]}},{key:"getKeysForValue",value:function(e){return Array.from(this.valuesByKey).filter((function(t){var r=(0,g.default)(t,2);r[0];return r[1].has(e)})).map((function(e){var t=(0,g.default)(e,2),r=t[0];t[1];return r}))}}]),e}(),J=function(e){"use strict";(0,_.default)(r,e);var t=(0,D.default)(r);function r(){var e;return(0,o.default)(this,r),(e=t.call(this)).keysByValue=new Map,e}return(0,u.default)(r,[{key:"values",get:function(){return Array.from(this.keysByValue.keys())}},{key:"add",value:function(e,t){(0,d.default)((0,v.default)(r.prototype),"add",this).call(this,e,t),G(this.keysByValue,t,e)}},{key:"delete",value:function(e,t){(0,d.default)((0,v.default)(r.prototype),"delete",this).call(this,e,t),z(this.keysByValue,t,e)}},{key:"hasValue",value:function(e){return this.keysByValue.has(e)}},{key:"getKeysForValue",value:function(e){var t=this.keysByValue.get(e);return t?Array.from(t):[]}}]),r}(U),Y=function(){"use strict";function e(t,r,n){(0,o.default)(this,e),this.attributeObserver=new K(t,r,this),this.delegate=n,this.tokensByElement=new U}return(0,u.default)(e,[{key:"started",get:function(){return this.attributeObserver.started}},{key:"start",value:function(){this.attributeObserver.start()}},{key:"pause",value:function(e){this.attributeObserver.pause(e)}},{key:"stop",value:function(){this.attributeObserver.stop()}},{key:"refresh",value:function(){this.attributeObserver.refresh()}},{key:"element",get:function(){return this.attributeObserver.element}},{key:"attributeName",get:function(){return this.attributeObserver.attributeName}},{key:"elementMatchedAttribute",value:function(e){this.tokensMatched(this.readTokensForElement(e))}},{key:"elementAttributeValueChanged",value:function(e){var t=(0,g.default)(this.refreshTokensForElement(e),2),r=t[0],n=t[1];this.tokensUnmatched(r),this.tokensMatched(n)}},{key:"elementUnmatchedAttribute",value:function(e){this.tokensUnmatched(this.tokensByElement.getValuesForKey(e))}},{key:"tokensMatched",value:function(e){var t=this;e.forEach((function(e){return t.tokenMatched(e)}))}},{key:"tokensUnmatched",value:function(e){var t=this;e.forEach((function(e){return t.tokenUnmatched(e)}))}},{key:"tokenMatched",value:function(e){this.delegate.tokenMatched(e),this.tokensByElement.add(e.element,e)}},{key:"tokenUnmatched",value:function(e){this.delegate.tokenUnmatched(e),this.tokensByElement.delete(e.element,e)}},{key:"refreshTokensForElement",value:function(e){var t,r,n,s=this.tokensByElement.getValuesForKey(e),i=this.readTokensForElement(e),a=(t=s,r=i,n=Math.max(t.length,r.length),Array.from({length:n},(function(e,n){return[t[n],r[n]]}))).findIndex((function(e){var t=(0,g.default)(e,2);return!function(e,t){return e&&t&&e.index==t.index&&e.content==t.content}(t[0],t[1])}));return-1==a?[[],[]]:[s.slice(a),i.slice(a)]}},{key:"readTokensForElement",value:function(e){var t=this.attributeName;return function(e,t,r){return e.trim().split(/\s+/).filter((function(e){return e.length})).map((function(e,n){return{element:t,attributeName:r,content:e,index:n}}))}(e.getAttribute(t)||"",e,t)}}]),e}();var Q=function(){"use strict";function e(t,r,n){(0,o.default)(this,e),this.tokenListObserver=new Y(t,r,this),this.delegate=n,this.parseResultsByToken=new WeakMap,this.valuesByTokenByElement=new WeakMap}return(0,u.default)(e,[{key:"started",get:function(){return this.tokenListObserver.started}},{key:"start",value:function(){this.tokenListObserver.start()}},{key:"stop",value:function(){this.tokenListObserver.stop()}},{key:"refresh",value:function(){this.tokenListObserver.refresh()}},{key:"element",get:function(){return this.tokenListObserver.element}},{key:"attributeName",get:function(){return this.tokenListObserver.attributeName}},{key:"tokenMatched",value:function(e){var t=e.element,r=this.fetchParseResultForToken(e).value;r&&(this.fetchValuesByTokenForElement(t).set(e,r),this.delegate.elementMatchedValue(t,r))}},{key:"tokenUnmatched",value:function(e){var t=e.element,r=this.fetchParseResultForToken(e).value;r&&(this.fetchValuesByTokenForElement(t).delete(e),this.delegate.elementUnmatchedValue(t,r))}},{key:"fetchParseResultForToken",value:function(e){var t=this.parseResultsByToken.get(e);return t||(t=this.parseToken(e),this.parseResultsByToken.set(e,t)),t}},{key:"fetchValuesByTokenForElement",value:function(e){var t=this.valuesByTokenByElement.get(e);return t||(t=new Map,this.valuesByTokenByElement.set(e,t)),t}},{key:"parseToken",value:function(e){try{return{value:this.delegate.parseValueForToken(e)}}catch(e){return{error:e}}}}]),e}(),X=function(){"use strict";function e(t,r){(0,o.default)(this,e),this.context=t,this.delegate=r,this.bindingsByAction=new Map}return(0,u.default)(e,[{key:"start",value:function(){this.valueListObserver||(this.valueListObserver=new Q(this.element,this.actionAttribute,this),this.valueListObserver.start())}},{key:"stop",value:function(){this.valueListObserver&&(this.valueListObserver.stop(),delete this.valueListObserver,this.disconnectAllActions())}},{key:"element",get:function(){return this.context.element}},{key:"identifier",get:function(){return this.context.identifier}},{key:"actionAttribute",get:function(){return this.schema.actionAttribute}},{key:"schema",get:function(){return this.context.schema}},{key:"bindings",get:function(){return Array.from(this.bindingsByAction.values())}},{key:"connectAction",value:function(e){var t=new B(this.context,e);this.bindingsByAction.set(e,t),this.delegate.bindingConnected(t)}},{key:"disconnectAction",value:function(e){var t=this.bindingsByAction.get(e);t&&(this.bindingsByAction.delete(e),this.delegate.bindingDisconnected(t))}},{key:"disconnectAllActions",value:function(){var e=this;this.bindings.forEach((function(t){return e.delegate.bindingDisconnected(t)})),this.bindingsByAction.clear()}},{key:"parseValueForToken",value:function(e){var t=L.forToken(e);if(t.identifier==this.identifier)return t}},{key:"elementMatchedValue",value:function(e,t){this.connectAction(t)}},{key:"elementUnmatchedValue",value:function(e,t){this.disconnectAction(t)}}]),e}(),Z=function(){"use strict";function e(t,r){(0,o.default)(this,e),this.context=t,this.receiver=r,this.stringMapObserver=new V(this.element,this),this.valueDescriptorMap=this.controller.valueDescriptorMap}return(0,u.default)(e,[{key:"start",value:function(){this.stringMapObserver.start(),this.invokeChangedCallbacksForDefaultValues()}},{key:"stop",value:function(){this.stringMapObserver.stop()}},{key:"element",get:function(){return this.context.element}},{key:"controller",get:function(){return this.context.controller}},{key:"getStringMapKeyForAttribute",value:function(e){if(e in this.valueDescriptorMap)return this.valueDescriptorMap[e].name}},{key:"stringMapKeyAdded",value:function(e,t){var r=this.valueDescriptorMap[t];this.hasValue(e)||this.invokeChangedCallback(e,r.writer(this.receiver[e]),r.writer(r.defaultValue))}},{key:"stringMapValueChanged",value:function(e,t,r){var n=this.valueDescriptorNameMap[t];null!==e&&(null===r&&(r=n.writer(n.defaultValue)),this.invokeChangedCallback(t,e,r))}},{key:"stringMapKeyRemoved",value:function(e,t,r){var n=this.valueDescriptorNameMap[e];this.hasValue(e)?this.invokeChangedCallback(e,n.writer(this.receiver[e]),r):this.invokeChangedCallback(e,n.writer(n.defaultValue),r)}},{key:"invokeChangedCallbacksForDefaultValues",value:function(){var e=!0,t=!1,r=void 0;try{for(var n,s=this.valueDescriptors[Symbol.iterator]();!(e=(n=s.next()).done);e=!0){var i=n.value,a=i.key,o=i.name,c=i.defaultValue,u=i.writer;null==c||this.controller.data.has(a)||this.invokeChangedCallback(o,u(c),void 0)}}catch(e){t=!0,r=e}finally{try{e||null==s.return||s.return()}finally{if(t)throw r}}}},{key:"invokeChangedCallback",value:function(e,t,r){var n="".concat(e,"Changed"),s=this.receiver[n];if("function"==typeof s){var i=this.valueDescriptorNameMap[e];try{var a=i.reader(t),o=r;r&&(o=i.reader(r)),s.call(this.receiver,a,o)}catch(e){if(!(e instanceof TypeError))throw e;throw new TypeError('Stimulus Value "'.concat(this.context.identifier,".").concat(i.name,'" - ').concat(e.message))}}}},{key:"valueDescriptors",get:function(){var e=this.valueDescriptorMap;return Object.keys(e).map((function(t){return e[t]}))}},{key:"valueDescriptorNameMap",get:function(){var e=this,t={};return Object.keys(this.valueDescriptorMap).forEach((function(r){var n=e.valueDescriptorMap[r];t[n.name]=n})),t}},{key:"hasValue",value:function(e){var t=this.valueDescriptorNameMap[e],r="has".concat(S(t.name));return this.receiver[r]}}]),e}(),$=function(){"use strict";function e(t,r){(0,o.default)(this,e),this.context=t,this.delegate=r,this.targetsByName=new U}return(0,u.default)(e,[{key:"start",value:function(){this.tokenListObserver||(this.tokenListObserver=new Y(this.element,this.attributeName,this),this.tokenListObserver.start())}},{key:"stop",value:function(){this.tokenListObserver&&(this.disconnectAllTargets(),this.tokenListObserver.stop(),delete this.tokenListObserver)}},{key:"tokenMatched",value:function(e){var t=e.element,r=e.content;this.scope.containsElement(t)&&this.connectTarget(t,r)}},{key:"tokenUnmatched",value:function(e){var t=e.element,r=e.content;this.disconnectTarget(t,r)}},{key:"connectTarget",value:function(e,t){var r,n=this;this.targetsByName.has(t,e)||(this.targetsByName.add(t,e),null===(r=this.tokenListObserver)||void 0===r||r.pause((function(){return n.delegate.targetConnected(e,t)})))}},{key:"disconnectTarget",value:function(e,t){var r,n=this;this.targetsByName.has(t,e)&&(this.targetsByName.delete(t,e),null===(r=this.tokenListObserver)||void 0===r||r.pause((function(){return n.delegate.targetDisconnected(e,t)})))}},{key:"disconnectAllTargets",value:function(){var e=!0,t=!1,r=void 0,n=!0,s=!1,i=void 0;try{for(var a,o=this.targetsByName.keys[Symbol.iterator]();!(n=(a=o.next()).done);n=!0){var c=a.value;try{for(var u,l=this.targetsByName.getValuesForKey(c)[Symbol.iterator]();!(e=(u=l.next()).done);e=!0){var h=u.value;this.disconnectTarget(h,c)}}catch(e){t=!0,r=e}finally{try{e||null==l.return||l.return()}finally{if(t)throw r}}}}catch(e){s=!0,i=e}finally{try{n||null==o.return||o.return()}finally{if(s)throw i}}}},{key:"attributeName",get:function(){return"data-".concat(this.context.identifier,"-target")}},{key:"element",get:function(){return this.context.element}},{key:"scope",get:function(){return this.context.scope}}]),e}(),ee=function(){"use strict";function e(t,r){var n=this;(0,o.default)(this,e),this.logDebugActivity=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=n.identifier,s=n.controller,i=n.element;t=Object.assign({identifier:r,controller:s,element:i},t),n.application.logDebugActivity(n.identifier,e,t)},this.module=t,this.scope=r,this.controller=new t.controllerConstructor(this),this.bindingObserver=new X(this,this.dispatcher),this.valueObserver=new Z(this,this.controller),this.targetObserver=new $(this,this);try{this.controller.initialize(),this.logDebugActivity("initialize")}catch(e){this.handleError(e,"initializing controller")}}return(0,u.default)(e,[{key:"connect",value:function(){this.bindingObserver.start(),this.valueObserver.start(),this.targetObserver.start();try{this.controller.connect(),this.logDebugActivity("connect")}catch(e){this.handleError(e,"connecting controller")}}},{key:"disconnect",value:function(){try{this.controller.disconnect(),this.logDebugActivity("disconnect")}catch(e){this.handleError(e,"disconnecting controller")}this.targetObserver.stop(),this.valueObserver.stop(),this.bindingObserver.stop()}},{key:"application",get:function(){return this.module.application}},{key:"identifier",get:function(){return this.module.identifier}},{key:"schema",get:function(){return this.application.schema}},{key:"dispatcher",get:function(){return this.application.dispatcher}},{key:"element",get:function(){return this.scope.element}},{key:"parentElement",get:function(){return this.element.parentElement}},{key:"handleError",value:function(e,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},n=this,s=n.identifier,i=n.controller,a=n.element;r=Object.assign({identifier:s,controller:i,element:a},r),this.application.handleError(e,"Error ".concat(t),r)}},{key:"targetConnected",value:function(e,t){this.invokeControllerMethod("".concat(t,"TargetConnected"),e)}},{key:"targetDisconnected",value:function(e,t){this.invokeControllerMethod("".concat(t,"TargetDisconnected"),e)}},{key:"invokeControllerMethod",value:function(e){for(var t=arguments.length,r=new Array(t>1?t-1:0),n=1;n<t;n++)r[n-1]=arguments[n];var s,i=this.controller;"function"==typeof i[e]&&(s=i)[e].apply(s,(0,b.default)(r))}}]),e}();function te(e,t){var r=ne(e);return Array.from(r.reduce((function(e,r){return function(e,t){var r=e[t];return Array.isArray(r)?r:[]}(r,t).forEach((function(t){return e.add(t)})),e}),new Set))}function re(e,t){return ne(e).reduce((function(e,r){var n;return(n=e).push.apply(n,(0,b.default)(function(e,t){var r=e[t];return r?Object.keys(r).map((function(e){return[e,r[e]]})):[]}(r,t))),e}),[])}function ne(e){for(var t=[];e;)t.push(e),e=Object.getPrototypeOf(e);return t.reverse()}function se(e){return function(e,t){var r=ae(e),n=function(e,t){return ie(t).reduce((function(r,n){var s=function(e,t,r){var n=Object.getOwnPropertyDescriptor(e,r);if(!n||!("value"in n)){var s=Object.getOwnPropertyDescriptor(t,r).value;return n&&(s.get=n.get||s.get,s.set=n.set||s.set),s}}(e,t,n);return s&&Object.assign(r,(0,h.default)({},n,s)),r}),{})}(e.prototype,t);return Object.defineProperties(r.prototype,n),r}(e,function(e){return te(e,"blessings").reduce((function(t,r){var n=r(e);for(var s in n){var i=t[s]||{};t[s]=Object.assign(i,n[s])}return t}),{})}(e))}var ie="function"==typeof Object.getOwnPropertySymbols?function(e){return(0,b.default)(Object.getOwnPropertyNames(e)).concat((0,b.default)(Object.getOwnPropertySymbols(e)))}:Object.getOwnPropertyNames,ae=function(){var e,t=function(e){function t(){return Reflect.construct(e,arguments,this instanceof t?this.constructor:void 0)}return t.prototype=Object.create(e.prototype,{constructor:{value:t}}),Reflect.setPrototypeOf(t,e),t};try{return(e=t((function(){this.a.call(this)}))).prototype.a=function(){},new e,t}catch(e){return function(e){return function(e){"use strict";(0,_.default)(r,e);var t=(0,D.default)(r);function r(){return(0,o.default)(this,r),t.apply(this,arguments)}return r}(e)}}}();var oe=function(){"use strict";function e(t,r){(0,o.default)(this,e),this.application=t,this.definition=function(e){return{identifier:e.identifier,controllerConstructor:se(e.controllerConstructor)}}(r),this.contextsByScope=new WeakMap,this.connectedContexts=new Set}return(0,u.default)(e,[{key:"identifier",get:function(){return this.definition.identifier}},{key:"controllerConstructor",get:function(){return this.definition.controllerConstructor}},{key:"contexts",get:function(){return Array.from(this.connectedContexts)}},{key:"connectContextForScope",value:function(e){var t=this.fetchContextForScope(e);this.connectedContexts.add(t),t.connect()}},{key:"disconnectContextForScope",value:function(e){var t=this.contextsByScope.get(e);t&&(this.connectedContexts.delete(t),t.disconnect())}},{key:"fetchContextForScope",value:function(e){var t=this.contextsByScope.get(e);return t||(t=new ee(this,e),this.contextsByScope.set(e,t)),t}}]),e}(),ce=function(){"use strict";function e(t){(0,o.default)(this,e),this.scope=t}return(0,u.default)(e,[{key:"has",value:function(e){return this.data.has(this.getDataKey(e))}},{key:"get",value:function(e){return this.getAll(e)[0]}},{key:"getAll",value:function(e){var t=this.data.get(this.getDataKey(e))||"";return t.match(/[^\s]+/g)||[]}},{key:"getAttributeName",value:function(e){return this.data.getAttributeNameForKey(this.getDataKey(e))}},{key:"getDataKey",value:function(e){return"".concat(e,"-class")}},{key:"data",get:function(){return this.scope.data}}]),e}(),ue=function(){"use strict";function e(t){(0,o.default)(this,e),this.scope=t}return(0,u.default)(e,[{key:"element",get:function(){return this.scope.element}},{key:"identifier",get:function(){return this.scope.identifier}},{key:"get",value:function(e){var t=this.getAttributeNameForKey(e);return this.element.getAttribute(t)}},{key:"set",value:function(e,t){var r=this.getAttributeNameForKey(e);return this.element.setAttribute(r,t),this.get(e)}},{key:"has",value:function(e){var t=this.getAttributeNameForKey(e);return this.element.hasAttribute(t)}},{key:"delete",value:function(e){if(this.has(e)){var t=this.getAttributeNameForKey(e);return this.element.removeAttribute(t),!0}return!1}},{key:"getAttributeNameForKey",value:function(e){return"data-".concat(this.identifier,"-").concat(P(e))}}]),e}(),le=function(){"use strict";function e(t){(0,o.default)(this,e),this.warnedKeysByObject=new WeakMap,this.logger=t}return(0,u.default)(e,[{key:"warn",value:function(e,t,r){var n=this.warnedKeysByObject.get(e);n||(n=new Set,this.warnedKeysByObject.set(e,n)),n.has(t)||(n.add(t),this.logger.warn(r,e))}}]),e}();function he(e,t){return"[".concat(e,'~="').concat(t,'"]')}var fe=function(){"use strict";function e(t){(0,o.default)(this,e),this.scope=t}return(0,u.default)(e,[{key:"element",get:function(){return this.scope.element}},{key:"identifier",get:function(){return this.scope.identifier}},{key:"schema",get:function(){return this.scope.schema}},{key:"has",value:function(e){return null!=this.find(e)}},{key:"find",value:function(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];var n=this;return t.reduce((function(e,t){return e||n.findTarget(t)||n.findLegacyTarget(t)}),void 0)}},{key:"findAll",value:function(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];var n=this;return t.reduce((function(e,t){return(0,b.default)(e).concat((0,b.default)(n.findAllTargets(t)),(0,b.default)(n.findAllLegacyTargets(t)))}),[])}},{key:"findTarget",value:function(e){var t=this.getSelectorForTargetName(e);return this.scope.findElement(t)}},{key:"findAllTargets",value:function(e){var t=this.getSelectorForTargetName(e);return this.scope.findAllElements(t)}},{key:"getSelectorForTargetName",value:function(e){return he(this.schema.targetAttributeForScope(this.identifier),e)}},{key:"findLegacyTarget",value:function(e){var t=this.getLegacySelectorForTargetName(e);return this.deprecate(this.scope.findElement(t),e)}},{key:"findAllLegacyTargets",value:function(e){var t=this,r=this.getLegacySelectorForTargetName(e);return this.scope.findAllElements(r).map((function(r){return t.deprecate(r,e)}))}},{key:"getLegacySelectorForTargetName",value:function(e){var t="".concat(this.identifier,".").concat(e);return he(this.schema.targetAttribute,t)}},{key:"deprecate",value:function(e,t){if(e){var r=this.identifier,n=this.schema.targetAttribute,s=this.schema.targetAttributeForScope(r);this.guide.warn(e,"target:".concat(t),"Please replace ".concat(n,'="').concat(r,".").concat(t,'" with ').concat(s,'="').concat(t,'". ')+"The ".concat(n," attribute is deprecated and will be removed in a future version of Stimulus."))}return e}},{key:"guide",get:function(){return this.scope.guide}}]),e}(),de=function(){"use strict";function e(t,r,n,s){var i=this;(0,o.default)(this,e),this.targets=new fe(this),this.classes=new ce(this),this.data=new ue(this),this.containsElement=function(e){return e.closest(i.controllerSelector)===i.element},this.schema=t,this.element=r,this.identifier=n,this.guide=new le(s)}return(0,u.default)(e,[{key:"findElement",value:function(e){return this.element.matches(e)?this.element:this.queryElements(e).find(this.containsElement)}},{key:"findAllElements",value:function(e){return(0,b.default)(this.element.matches(e)?[this.element]:[]).concat((0,b.default)(this.queryElements(e).filter(this.containsElement)))}},{key:"queryElements",value:function(e){return Array.from(this.element.querySelectorAll(e))}},{key:"controllerSelector",get:function(){return he(this.schema.controllerAttribute,this.identifier)}}]),e}(),pe=function(){"use strict";function e(t,r,n){(0,o.default)(this,e),this.element=t,this.schema=r,this.delegate=n,this.valueListObserver=new Q(this.element,this.controllerAttribute,this),this.scopesByIdentifierByElement=new WeakMap,this.scopeReferenceCounts=new WeakMap}return(0,u.default)(e,[{key:"start",value:function(){this.valueListObserver.start()}},{key:"stop",value:function(){this.valueListObserver.stop()}},{key:"controllerAttribute",get:function(){return this.schema.controllerAttribute}},{key:"parseValueForToken",value:function(e){var t=e.element,r=e.content,n=this.fetchScopesByIdentifierForElement(t),s=n.get(r);return s||(s=this.delegate.createScopeForElementAndIdentifier(t,r),n.set(r,s)),s}},{key:"elementMatchedValue",value:function(e,t){var r=(this.scopeReferenceCounts.get(t)||0)+1;this.scopeReferenceCounts.set(t,r),1==r&&this.delegate.scopeConnected(t)}},{key:"elementUnmatchedValue",value:function(e,t){var r=this.scopeReferenceCounts.get(t);r&&(this.scopeReferenceCounts.set(t,r-1),1==r&&this.delegate.scopeDisconnected(t))}},{key:"fetchScopesByIdentifierForElement",value:function(e){var t=this.scopesByIdentifierByElement.get(e);return t||(t=new Map,this.scopesByIdentifierByElement.set(e,t)),t}}]),e}(),ve=function(){"use strict";function e(t){(0,o.default)(this,e),this.application=t,this.scopeObserver=new pe(this.element,this.schema,this),this.scopesByIdentifier=new U,this.modulesByIdentifier=new Map}return(0,u.default)(e,[{key:"element",get:function(){return this.application.element}},{key:"schema",get:function(){return this.application.schema}},{key:"logger",get:function(){return this.application.logger}},{key:"controllerAttribute",get:function(){return this.schema.controllerAttribute}},{key:"modules",get:function(){return Array.from(this.modulesByIdentifier.values())}},{key:"contexts",get:function(){return this.modules.reduce((function(e,t){return e.concat(t.contexts)}),[])}},{key:"start",value:function(){this.scopeObserver.start()}},{key:"stop",value:function(){this.scopeObserver.stop()}},{key:"loadDefinition",value:function(e){this.unloadIdentifier(e.identifier);var t=new oe(this.application,e);this.connectModule(t)}},{key:"unloadIdentifier",value:function(e){var t=this.modulesByIdentifier.get(e);t&&this.disconnectModule(t)}},{key:"getContextForElementAndIdentifier",value:function(e,t){var r=this.modulesByIdentifier.get(t);if(r)return r.contexts.find((function(t){return t.element==e}))}},{key:"handleError",value:function(e,t,r){this.application.handleError(e,t,r)}},{key:"createScopeForElementAndIdentifier",value:function(e,t){return new de(this.schema,e,t,this.logger)}},{key:"scopeConnected",value:function(e){this.scopesByIdentifier.add(e.identifier,e);var t=this.modulesByIdentifier.get(e.identifier);t&&t.connectContextForScope(e)}},{key:"scopeDisconnected",value:function(e){this.scopesByIdentifier.delete(e.identifier,e);var t=this.modulesByIdentifier.get(e.identifier);t&&t.disconnectContextForScope(e)}},{key:"connectModule",value:function(e){this.modulesByIdentifier.set(e.identifier,e),this.scopesByIdentifier.getValuesForKey(e.identifier).forEach((function(t){return e.connectContextForScope(t)}))}},{key:"disconnectModule",value:function(e){this.modulesByIdentifier.delete(e.identifier),this.scopesByIdentifier.getValuesForKey(e.identifier).forEach((function(t){return e.disconnectContextForScope(t)}))}}]),e}(),me={controllerAttribute:"data-controller",actionAttribute:"data-action",targetAttribute:"data-target",targetAttributeForScope:function(e){return"data-".concat(e,"-target")}},_e=function(){"use strict";function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:document.documentElement,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:me,n=this;(0,o.default)(this,e),this.logger=console,this.debug=!1,this.logDebugActivity=function(e,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};n.debug&&n.logFormattedMessage(e,t,r)},this.element=t,this.schema=r,this.dispatcher=new R(this),this.router=new ve(this)}return(0,u.default)(e,[{key:"start",value:function(){var e=this;return(0,i.default)(O.default.mark((function t(){return O.default.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,new Promise((function(e){"loading"==document.readyState?document.addEventListener("DOMContentLoaded",(function(){return e()})):e()}));case 2:e.logDebugActivity("application","starting"),e.dispatcher.start(),e.router.start(),e.logDebugActivity("application","start");case 6:case"end":return t.stop()}}),t)})))()}},{key:"stop",value:function(){this.logDebugActivity("application","stopping"),this.dispatcher.stop(),this.router.stop(),this.logDebugActivity("application","stop")}},{key:"register",value:function(e,t){this.load({identifier:e,controllerConstructor:t})}},{key:"load",value:function(e){for(var t=arguments.length,r=new Array(t>1?t-1:0),n=1;n<t;n++)r[n-1]=arguments[n];var s=this,i=Array.isArray(e)?e:[e].concat((0,b.default)(r));i.forEach((function(e){e.controllerConstructor.shouldLoad&&s.router.loadDefinition(e)}))}},{key:"unload",value:function(e){for(var t=arguments.length,r=new Array(t>1?t-1:0),n=1;n<t;n++)r[n-1]=arguments[n];var s=this,i=Array.isArray(e)?e:[e].concat((0,b.default)(r));i.forEach((function(e){return s.router.unloadIdentifier(e)}))}},{key:"controllers",get:function(){return this.router.contexts.map((function(e){return e.controller}))}},{key:"getControllerForElementAndIdentifier",value:function(e,t){var r=this.router.getContextForElementAndIdentifier(e,t);return r?r.controller:null}},{key:"handleError",value:function(e,t,r){var n;this.logger.error("%s\n\n%o\n\n%o",t,e,r),null===(n=window.onerror)||void 0===n||n.call(window,t,"",0,0,e)}},{key:"logFormattedMessage",value:function(e,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};r=Object.assign({application:this},r),this.logger.groupCollapsed("".concat(e," #").concat(t)),this.logger.log("details:",Object.assign({},r)),this.logger.groupEnd()}}],[{key:"start",value:function(t,r){var n=new e(t,r);return n.start(),n}}]),e}();function ye(e,t){var r,n,s,i=(0,g.default)(e,2),a=i[0],o=i[1];return n="".concat(P((r={controller:t,token:a,typeDefinition:o}).token),"-value"),s=function(e){var t=function(e){var t=ge(e.typeObject.type);if(t){var r=ke(e.typeObject.default);if(t!==r){var n=e.controller?"".concat(e.controller,".").concat(e.token):e.token;throw new Error('The specified default value for the Stimulus Value "'.concat(n,'" must match the defined type "').concat(t,'". The provided default value of "').concat(e.typeObject.default,'" is of type "').concat(r,'".'))}return t}}({controller:e.controller,token:e.token,typeObject:e.typeDefinition}),r=ke(e.typeDefinition),n=ge(e.typeDefinition),s=t||r||n;if(s)return s;var i=e.controller?"".concat(e.controller,".").concat(e.typeDefinition):e.token;throw new Error('Unknown value type "'.concat(i,'" for "').concat(e.token,'" value'))}(r),{type:s,key:n,name:T(n),get defaultValue(){return function(e){var t=ge(e);if(t)return be[t];var r=e.default;return void 0!==r?r:e}(r.typeDefinition)},get hasCustomDefaultValue(){return void 0!==ke(r.typeDefinition)},reader:we[s],writer:je[s]||je.default}}function ge(e){switch(e){case Array:return"array";case Boolean:return"boolean";case Number:return"number";case Object:return"object";case String:return"string"}}function ke(e){switch(void 0===e?"undefined":(0,j.default)(e)){case"boolean":return"boolean";case"number":return"number";case"string":return"string"}return Array.isArray(e)?"array":"[object Object]"===Object.prototype.toString.call(e)?"object":void 0}var be={get array(){return[]},boolean:!1,number:0,get object(){return{}},string:""},we={array:function(e){var t=JSON.parse(e);if(!Array.isArray(t))throw new TypeError('expected value of type "array" but instead got value "'.concat(e,'" of type "').concat(ke(t),'"'));return t},boolean:function(e){return!("0"==e||"false"==String(e).toLowerCase())},number:function(e){return Number(e)},object:function(e){var t=JSON.parse(e);if(null===t||"object"!=typeof t||Array.isArray(t))throw new TypeError('expected value of type "object" but instead got value "'.concat(e,'" of type "').concat(ke(t),'"'));return t},string:function(e){return e}},je={default:function(e){return"".concat(e)},array:xe,object:xe};function xe(e){return JSON.stringify(e)}var De=function(){"use strict";function e(t){(0,o.default)(this,e),this.context=t}return(0,u.default)(e,[{key:"application",get:function(){return this.context.application}},{key:"scope",get:function(){return this.context.scope}},{key:"element",get:function(){return this.scope.element}},{key:"identifier",get:function(){return this.scope.identifier}},{key:"targets",get:function(){return this.scope.targets}},{key:"classes",get:function(){return this.scope.classes}},{key:"data",get:function(){return this.scope.data}},{key:"initialize",value:function(){}},{key:"connect",value:function(){}},{key:"disconnect",value:function(){}},{key:"dispatch",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=t.target,n=void 0===r?this.element:r,s=t.detail,i=void 0===s?{}:s,a=t.prefix,o=void 0===a?this.identifier:a,c=t.bubbles,u=void 0===c||c,l=t.cancelable,h=void 0===l||l,f=o?"".concat(o,":").concat(e):e,d=new CustomEvent(f,{detail:i,bubbles:u,cancelable:h});return n.dispatchEvent(d),d}}],[{key:"shouldLoad",get:function(){return!0}}]),e}();De.blessings=[function(e){return te(e,"classes").reduce((function(e,t){return Object.assign(e,(r=t,n={},(0,h.default)(n,"".concat(r,"Class"),{get:function(){var e=this.classes;if(e.has(r))return e.get(r);var t=e.getAttributeName(r);throw new Error('Missing attribute "'.concat(t,'"'))}}),(0,h.default)(n,"".concat(r,"Classes"),{get:function(){return this.classes.getAll(r)}}),(0,h.default)(n,"has".concat(S(r),"Class"),{get:function(){return this.classes.has(r)}}),n));var r,n}),{})},function(e){return te(e,"targets").reduce((function(e,t){return Object.assign(e,(r=t,n={},(0,h.default)(n,"".concat(r,"Target"),{get:function(){var e=this.targets.find(r);if(e)return e;throw new Error('Missing target element "'.concat(r,'" for "').concat(this.identifier,'" controller'))}}),(0,h.default)(n,"".concat(r,"Targets"),{get:function(){return this.targets.findAll(r)}}),(0,h.default)(n,"has".concat(S(r),"Target"),{get:function(){return this.targets.has(r)}}),n));var r,n}),{})},function(e){var t=re(e,"values"),r={valueDescriptorMap:{get:function(){var e=this;return t.reduce((function(t,r){var n=ye(r,e.identifier),s=e.data.getAttributeNameForKey(n.key);return Object.assign(t,(0,h.default)({},s,n))}),{})}}};return t.reduce((function(e,t){return Object.assign(e,function(e,t){var r,n=ye(e,t),s=n.key,i=n.name,a=n.reader,o=n.writer;return r={},(0,h.default)(r,i,{get:function(){var e=this.data.get(s);return null!==e?a(e):n.defaultValue},set:function(e){void 0===e?this.data.delete(s):this.data.set(s,o(e))}}),(0,h.default)(r,"has".concat(S(i)),{get:function(){return this.data.has(s)||n.hasCustomDefaultValue}}),r}(t))}),r)}],De.targets=[],De.values={}},{"@swc/helpers/src/_async_to_generator.mjs":"d46FK","@swc/helpers/src/_class_call_check.mjs":"bcDJH","@swc/helpers/src/_create_class.mjs":"e1EPh","@swc/helpers/src/_define_property.mjs":"gz59H","@swc/helpers/src/_get.mjs":"eHFAS","@swc/helpers/src/_get_prototype_of.mjs":"1gzL0","@swc/helpers/src/_inherits.mjs":"kfOz5","@swc/helpers/src/_sliced_to_array.mjs":"3lmqd","@swc/helpers/src/_to_consumable_array.mjs":"lp3rF","@swc/helpers/src/_type_of.mjs":"hzP4T","@swc/helpers/src/_create_super.mjs":"dJHhu","regenerator-runtime":"achxx","@parcel/transformer-js/src/esmodule-helpers.js":"3ieD1"}],d46FK:[function(e,t,r){function n(e,t,r,n,s,i,a){try{var o=e[i](a),c=o.value}catch(e){return void r(e)}o.done?t(c):Promise.resolve(c).then(n,s)}e("@parcel/transformer-js/src/esmodule-helpers.js").defineInteropFlag(r),r.default=function(e){return function(){var t=this,r=arguments;return new Promise((function(s,i){var a=e.apply(t,r);function o(e){n(a,s,i,o,c,"next",e)}function c(e){n(a,s,i,o,c,"throw",e)}o(void 0)}))}}},{"@parcel/transformer-js/src/esmodule-helpers.js":"3ieD1"}],"3ieD1":[function(e,t,r){r.interopDefault=function(e){return e&&e.__esModule?e:{default:e}},r.defineInteropFlag=function(e){Object.defineProperty(e,"__esModule",{value:!0})},r.exportAll=function(e,t){return Object.keys(e).forEach((function(r){"default"===r||"__esModule"===r||t.hasOwnProperty(r)||Object.defineProperty(t,r,{enumerable:!0,get:function(){return e[r]}})})),t},r.export=function(e,t,r){Object.defineProperty(e,t,{enumerable:!0,get:r})}},{}],bcDJH:[function(e,t,r){e("@parcel/transformer-js/src/esmodule-helpers.js").defineInteropFlag(r),r.default=function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}},{"@parcel/transformer-js/src/esmodule-helpers.js":"3ieD1"}],e1EPh:[function(e,t,r){function n(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}e("@parcel/transformer-js/src/esmodule-helpers.js").defineInteropFlag(r),r.default=function(e,t,r){return t&&n(e.prototype,t),r&&n(e,r),e}},{"@parcel/transformer-js/src/esmodule-helpers.js":"3ieD1"}],gz59H:[function(e,t,r){e("@parcel/transformer-js/src/esmodule-helpers.js").defineInteropFlag(r),r.default=function(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}},{"@parcel/transformer-js/src/esmodule-helpers.js":"3ieD1"}],eHFAS:[function(e,t,r){var n=e("@parcel/transformer-js/src/esmodule-helpers.js");n.defineInteropFlag(r);var s=e("./_super_prop_base.mjs"),i=n.interopDefault(s);function a(e,t,r){return a="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,r){var n=(0,i.default)(e,t);if(n){var s=Object.getOwnPropertyDescriptor(n,t);return s.get?s.get.call(r||e):s.value}},a(e,t,r)}r.default=function(e,t,r){return a(e,t,r)}},{"./_super_prop_base.mjs":"1iO0a","@parcel/transformer-js/src/esmodule-helpers.js":"3ieD1"}],"1iO0a":[function(e,t,r){var n=e("@parcel/transformer-js/src/esmodule-helpers.js");n.defineInteropFlag(r);var s=e("./_get_prototype_of.mjs"),i=n.interopDefault(s);r.default=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=(0,i.default)(e)););return e}},{"./_get_prototype_of.mjs":"1gzL0","@parcel/transformer-js/src/esmodule-helpers.js":"3ieD1"}],"1gzL0":[function(e,t,r){function n(e){return n=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)},n(e)}e("@parcel/transformer-js/src/esmodule-helpers.js").defineInteropFlag(r),r.default=function(e){return n(e)}},{"@parcel/transformer-js/src/esmodule-helpers.js":"3ieD1"}],kfOz5:[function(e,t,r){var n=e("@parcel/transformer-js/src/esmodule-helpers.js");n.defineInteropFlag(r);var s=e("./_set_prototype_of.mjs"),i=n.interopDefault(s);r.default=function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&(0,i.default)(e,t)}},{"./_set_prototype_of.mjs":"dS33n","@parcel/transformer-js/src/esmodule-helpers.js":"3ieD1"}],dS33n:[function(e,t,r){function n(e,t){return n=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e},n(e,t)}e("@parcel/transformer-js/src/esmodule-helpers.js").defineInteropFlag(r),r.default=function(e,t){return n(e,t)}},{"@parcel/transformer-js/src/esmodule-helpers.js":"3ieD1"}],"3lmqd":[function(e,t,r){var n=e("@parcel/transformer-js/src/esmodule-helpers.js");n.defineInteropFlag(r);var s=e("./_array_with_holes.mjs"),i=n.interopDefault(s),a=e("./_iterable_to_array.mjs"),o=n.interopDefault(a),c=e("./_non_iterable_rest.mjs"),u=n.interopDefault(c),l=e("./_unsupported_iterable_to_array.mjs"),h=n.interopDefault(l);r.default=function(e,t){return(0,i.default)(e)||(0,o.default)(e,t)||(0,h.default)(e,t)||(0,u.default)()}},{"./_array_with_holes.mjs":"bOETF","./_iterable_to_array.mjs":"5xef1","./_non_iterable_rest.mjs":"fd7AC","./_unsupported_iterable_to_array.mjs":"9fTEq","@parcel/transformer-js/src/esmodule-helpers.js":"3ieD1"}],bOETF:[function(e,t,r){e("@parcel/transformer-js/src/esmodule-helpers.js").defineInteropFlag(r),r.default=function(e){if(Array.isArray(e))return e}},{"@parcel/transformer-js/src/esmodule-helpers.js":"3ieD1"}],"5xef1":[function(e,t,r){e("@parcel/transformer-js/src/esmodule-helpers.js").defineInteropFlag(r),r.default=function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}},{"@parcel/transformer-js/src/esmodule-helpers.js":"3ieD1"}],fd7AC:[function(e,t,r){e("@parcel/transformer-js/src/esmodule-helpers.js").defineInteropFlag(r),r.default=function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}},{"@parcel/transformer-js/src/esmodule-helpers.js":"3ieD1"}],"9fTEq":[function(e,t,r){var n=e("@parcel/transformer-js/src/esmodule-helpers.js");n.defineInteropFlag(r);var s=e("./_array_like_to_array.mjs"),i=n.interopDefault(s);r.default=function(e,t){if(e){if("string"==typeof e)return(0,i.default)(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(r):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?(0,i.default)(e,t):void 0}}},{"./_array_like_to_array.mjs":"aqJWY","@parcel/transformer-js/src/esmodule-helpers.js":"3ieD1"}],aqJWY:[function(e,t,r){e("@parcel/transformer-js/src/esmodule-helpers.js").defineInteropFlag(r),r.default=function(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}},{"@parcel/transformer-js/src/esmodule-helpers.js":"3ieD1"}],lp3rF:[function(e,t,r){var n=e("@parcel/transformer-js/src/esmodule-helpers.js");n.defineInteropFlag(r);var s=e("./_array_without_holes.mjs"),i=n.interopDefault(s),a=e("./_iterable_to_array.mjs"),o=n.interopDefault(a),c=e("./_non_iterable_spread.mjs"),u=n.interopDefault(c),l=e("./_unsupported_iterable_to_array.mjs"),h=n.interopDefault(l);r.default=function(e){return(0,i.default)(e)||(0,o.default)(e)||(0,h.default)(e)||(0,u.default)()}},{"./_array_without_holes.mjs":"lOgiP","./_iterable_to_array.mjs":"5xef1","./_non_iterable_spread.mjs":"3W2Gw","./_unsupported_iterable_to_array.mjs":"9fTEq","@parcel/transformer-js/src/esmodule-helpers.js":"3ieD1"}],lOgiP:[function(e,t,r){var n=e("@parcel/transformer-js/src/esmodule-helpers.js");n.defineInteropFlag(r);var s=e("./_array_like_to_array.mjs"),i=n.interopDefault(s);r.default=function(e){if(Array.isArray(e))return(0,i.default)(e)}},{"./_array_like_to_array.mjs":"aqJWY","@parcel/transformer-js/src/esmodule-helpers.js":"3ieD1"}],"3W2Gw":[function(e,t,r){e("@parcel/transformer-js/src/esmodule-helpers.js").defineInteropFlag(r),r.default=function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}},{"@parcel/transformer-js/src/esmodule-helpers.js":"3ieD1"}],hzP4T:[function(e,t,r){e("@parcel/transformer-js/src/esmodule-helpers.js").defineInteropFlag(r),r.default=function(e){return e&&e.constructor===Symbol?"symbol":typeof e}},{"@parcel/transformer-js/src/esmodule-helpers.js":"3ieD1"}],dJHhu:[function(e,t,r){var n=e("@parcel/transformer-js/src/esmodule-helpers.js");n.defineInteropFlag(r);var s=e("./_is_native_reflect_construct.mjs"),i=n.interopDefault(s),a=e("./_get_prototype_of.mjs"),o=n.interopDefault(a),c=e("./_possible_constructor_return.mjs"),u=n.interopDefault(c);r.default=function(e){var t=(0,i.default)();return function(){var r,n=(0,o.default)(e);if(t){var s=(0,o.default)(this).constructor;r=Reflect.construct(n,arguments,s)}else r=n.apply(this,arguments);return(0,u.default)(this,r)}}},{"./_is_native_reflect_construct.mjs":"cyOXh","./_get_prototype_of.mjs":"1gzL0","./_possible_constructor_return.mjs":"gDAp7","@parcel/transformer-js/src/esmodule-helpers.js":"3ieD1"}],cyOXh:[function(e,t,r){e("@parcel/transformer-js/src/esmodule-helpers.js").defineInteropFlag(r),r.default=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}},{"@parcel/transformer-js/src/esmodule-helpers.js":"3ieD1"}],gDAp7:[function(e,t,r){var n=e("@parcel/transformer-js/src/esmodule-helpers.js");n.defineInteropFlag(r);var s=e("./_assert_this_initialized.mjs"),i=n.interopDefault(s),a=e("./_type_of.mjs"),o=n.interopDefault(a);r.default=function(e,t){return!t||"object"!==(0,o.default)(t)&&"function"!=typeof t?(0,i.default)(e):t}},{"./_assert_this_initialized.mjs":"1hTTt","./_type_of.mjs":"hzP4T","@parcel/transformer-js/src/esmodule-helpers.js":"3ieD1"}],"1hTTt":[function(e,t,r){e("@parcel/transformer-js/src/esmodule-helpers.js").defineInteropFlag(r),r.default=function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}},{"@parcel/transformer-js/src/esmodule-helpers.js":"3ieD1"}],achxx:[function(e,t,r){var n=function(e){"use strict";var t,r=function(e,t,r){return Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}),e[t]},n=function(e,t,r,n){var s=t&&t.prototype instanceof i?t:i,a=Object.create(s.prototype),o=new d(n||[]);return a._invoke=l(e,r,o),a},s=function(e,t,r){try{return{type:"normal",arg:e.call(t,r)}}catch(e){return{type:"throw",arg:e}}},i=function(){},a=function(){},o=function(){},c=function(e){["next","throw","return"].forEach((function(t){r(e,t,(function(e){return this._invoke(t,e)}))}))},u=function(e,t){function r(n,i,a,o){var c=s(e[n],e,i);if("throw"!==c.type){var u=c.arg,l=u.value;return l&&"object"==typeof l&&_.call(l,"__await")?t.resolve(l.__await).then((function(e){r("next",e,a,o)}),(function(e){r("throw",e,a,o)})):t.resolve(l).then((function(e){u.value=e,a(u)}),(function(e){return r("throw",e,a,o)}))}o(c.arg)}var n;this._invoke=function(e,s){function i(){return new t((function(t,n){r(e,s,t,n)}))}return n=n?n.then(i,i):i()}},l=function(e,t,r){var n=w;return function(i,a){if(n===x)throw new Error("Generator is already running");if(n===D){if("throw"===i)throw a;return v()}for(r.method=i,r.arg=a;;){var o=r.delegate;if(o){var c=I(o,r);if(c){if(c===E)continue;return c}}if("next"===r.method)r.sent=r._sent=r.arg;else if("throw"===r.method){if(n===w)throw n=D,r.arg;r.dispatchException(r.arg)}else"return"===r.method&&r.abrupt("return",r.arg);n=x;var u=s(e,t,r);if("normal"===u.type){if(n=r.done?D:j,u.arg===E)continue;return{value:u.arg,done:r.done}}"throw"===u.type&&(n=D,r.method="throw",r.arg=u.arg)}}},h=function(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)},f=function(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t},d=function(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(h,this),this.reset(!0)},p=function(e){if(e){var r=e[g];if(r)return r.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var n=-1,s=function r(){for(;++n<e.length;)if(_.call(e,n))return r.value=e[n],r.done=!1,r;return r.value=t,r.done=!0,r};return s.next=s}}return{next:v}},v=function(){return{value:t,done:!0}},m=Object.prototype,_=m.hasOwnProperty,y="function"==typeof Symbol?Symbol:{},g=y.iterator||"@@iterator",k=y.asyncIterator||"@@asyncIterator",b=y.toStringTag||"@@toStringTag";try{r({},"")}catch(e){r=function(e,t,r){return e[t]=r}}e.wrap=n;var w="suspendedStart",j="suspendedYield",x="executing",D="completed",E={},O={};r(O,g,(function(){return this}));var A=Object.getPrototypeOf,R=A&&A(A(p([])));R&&R!==m&&_.call(R,g)&&(O=R);var C=o.prototype=i.prototype=Object.create(O);function I(e,r){var n=e.iterator[r.method];if(n===t){if(r.delegate=null,"throw"===r.method){if(e.iterator.return&&(r.method="return",r.arg=t,I(e,r),"throw"===r.method))return E;r.method="throw",r.arg=new TypeError("The iterator does not provide a 'throw' method")}return E}var i=s(n,e.iterator,r.arg);if("throw"===i.type)return r.method="throw",r.arg=i.arg,r.delegate=null,E;var a=i.arg;return a?a.done?(r[e.resultName]=a.value,r.next=e.nextLoc,"return"!==r.method&&(r.method="next",r.arg=t),r.delegate=null,E):a:(r.method="throw",r.arg=new TypeError("iterator result is not an object"),r.delegate=null,E)}return a.prototype=o,r(C,"constructor",o),r(o,"constructor",a),a.displayName=r(o,b,"GeneratorFunction"),e.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===a||"GeneratorFunction"===(t.displayName||t.name))},e.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,o):(e.__proto__=o,r(e,b,"GeneratorFunction")),e.prototype=Object.create(C),e},e.awrap=function(e){return{__await:e}},c(u.prototype),r(u.prototype,k,(function(){return this})),e.AsyncIterator=u,e.async=function(t,r,s,i,a){void 0===a&&(a=Promise);var o=new u(n(t,r,s,i),a);return e.isGeneratorFunction(r)?o:o.next().then((function(e){return e.done?e.value:o.next()}))},c(C),r(C,b,"Generator"),r(C,g,(function(){return this})),r(C,"toString",(function(){return"[object Generator]"})),e.keys=function(e){var t=[];for(var r in e)t.push(r);return t.reverse(),function r(){for(;t.length;){var n=t.pop();if(n in e)return r.value=n,r.done=!1,r}return r.done=!0,r}},e.values=p,d.prototype={constructor:d,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=t,this.done=!1,this.delegate=null,this.method="next",this.arg=t,this.tryEntries.forEach(f),!e)for(var r in this)"t"===r.charAt(0)&&_.call(this,r)&&!isNaN(+r.slice(1))&&(this[r]=t)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(e){var r=function(r,s){return a.type="throw",a.arg=e,n.next=r,s&&(n.method="next",n.arg=t),!!s};if(this.done)throw e;for(var n=this,s=this.tryEntries.length-1;s>=0;--s){var i=this.tryEntries[s],a=i.completion;if("root"===i.tryLoc)return r("end");if(i.tryLoc<=this.prev){var o=_.call(i,"catchLoc"),c=_.call(i,"finallyLoc");if(o&&c){if(this.prev<i.catchLoc)return r(i.catchLoc,!0);if(this.prev<i.finallyLoc)return r(i.finallyLoc)}else if(o){if(this.prev<i.catchLoc)return r(i.catchLoc,!0)}else{if(!c)throw new Error("try statement without catch or finally");if(this.prev<i.finallyLoc)return r(i.finallyLoc)}}}},abrupt:function(e,t){for(var r=this.tryEntries.length-1;r>=0;--r){var n=this.tryEntries[r];if(n.tryLoc<=this.prev&&_.call(n,"finallyLoc")&&this.prev<n.finallyLoc){var s=n;break}}s&&("break"===e||"continue"===e)&&s.tryLoc<=t&&t<=s.finallyLoc&&(s=null);var i=s?s.completion:{};return i.type=e,i.arg=t,s?(this.method="next",this.next=s.finallyLoc,E):this.complete(i)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),E},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var r=this.tryEntries[t];if(r.finallyLoc===e)return this.complete(r.completion,r.afterLoc),f(r),E}},catch:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var r=this.tryEntries[t];if(r.tryLoc===e){var n=r.completion;if("throw"===n.type){var s=n.arg;f(r)}return s}}throw new Error("illegal catch attempt")},delegateYield:function(e,r,n){return this.delegate={iterator:p(e),resultName:r,nextLoc:n},"next"===this.method&&(this.arg=t),E}},e}(t.exports);try{regeneratorRuntime=n}catch(e){"object"==typeof globalThis?globalThis.regeneratorRuntime=n:Function("r","regeneratorRuntime = r")(n)}},{}],"2Z9zf":[function(e,t,r){var n=e("@parcel/transformer-js/src/esmodule-helpers.js");n.defineInteropFlag(r),n.export(r,"default",(function(){return f}));var s=e("@swc/helpers/src/_class_call_check.mjs"),i=n.interopDefault(s),a=e("@swc/helpers/src/_create_class.mjs"),o=n.interopDefault(a),c=e("@swc/helpers/src/_inherits.mjs"),u=n.interopDefault(c),l=e("@swc/helpers/src/_create_super.mjs"),h=n.interopDefault(l),f=function(e){"use strict";(0,u.default)(r,e);var t=(0,h.default)(r);function r(){return(0,i.default)(this,r),t.apply(this,arguments)}return(0,o.default)(r,[{key:"start",value:function(){var e=new URL("https://www.reddit.com/api/v1/authorize.compact"),t=Math.random().toString(36).slice(2);document.cookie="authorization_state=".concat(t),e.searchParams.append("client_id","sTwm7bm3nY-AE8xr7LjAkA"),e.searchParams.append("response_type","token"),e.searchParams.append("state",t),e.searchParams.append("redirect_uri","https://rnuke.github.io/start"),e.searchParams.append("duration","temporary"),e.searchParams.append("scope","identity edit history"),window.location.href=e.href}}]),r}(e("@hotwired/stimulus").Controller)},{"@swc/helpers/src/_class_call_check.mjs":"bcDJH","@swc/helpers/src/_create_class.mjs":"e1EPh","@swc/helpers/src/_inherits.mjs":"kfOz5","@swc/helpers/src/_create_super.mjs":"dJHhu","@hotwired/stimulus":"51pPy","@parcel/transformer-js/src/esmodule-helpers.js":"3ieD1"}],bRnoY:[function(e,t,r){var n=e("@parcel/transformer-js/src/esmodule-helpers.js");n.defineInteropFlag(r),n.export(r,"default",(function(){return q}));var s=e("@swc/helpers/src/_assert_this_initialized.mjs"),i=n.interopDefault(s),a=e("@swc/helpers/src/_async_to_generator.mjs"),o=n.interopDefault(a),c=e("@swc/helpers/src/_class_call_check.mjs"),u=n.interopDefault(c),l=e("@swc/helpers/src/_class_private_field_get.mjs"),h=n.interopDefault(l),f=e("@swc/helpers/src/_class_private_field_init.mjs"),d=n.interopDefault(f),p=e("@swc/helpers/src/_class_private_field_set.mjs"),v=n.interopDefault(p),m=e("@swc/helpers/src/_class_private_method_get.mjs"),_=n.interopDefault(m),y=e("@swc/helpers/src/_class_private_method_init.mjs"),g=n.interopDefault(y),k=e("@swc/helpers/src/_create_class.mjs"),b=n.interopDefault(k),w=e("@swc/helpers/src/_inherits.mjs"),j=n.interopDefault(w),x=e("@swc/helpers/src/_sliced_to_array.mjs"),D=n.interopDefault(x),E=e("@swc/helpers/src/_create_super.mjs"),O=n.interopDefault(E),A=e("regenerator-runtime"),R=n.interopDefault(A),C=e("@hotwired/stimulus"),I=e("./nuke_controller/client"),T=n.interopDefault(I),S=e("./nuke_controller/commentHandler"),P=n.interopDefault(S),L=e("./nuke_controller/postHandler"),F=n.interopDefault(L),M=new WeakMap,N=new WeakSet,B=new WeakMap,q=function(e){"use strict";(0,j.default)(r,e);var t=(0,O.default)(r);function r(){var e;return(0,u.default)(this,r),e=t.apply(this,arguments),(0,d.default)((0,i.default)(e),M,{get:K,set:void 0}),(0,g.default)((0,i.default)(e),N),(0,d.default)((0,i.default)(e),B,{get:void 0,set:G}),e}return(0,b.default)(r,[{key:"connect",value:function(){var e=this;return(0,o.default)(R.default.mark((function t(){var r,n,s,i;return R.default.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if((0,_.default)(e,N,V).call(e,"authorization_state")==(0,h.default)(e,M).get("state")){t.next=2;break}throw new Error("Unable to verify authorization request");case 2:return(0,v.default)(e,B,"Loading Posts"),r=new(0,T.default)((0,h.default)(e,M).get("access_token")),t.next=6,r.getUser((function(e){return e.name}));case 6:return n=t.sent,s=new(0,F.default)(r,n),t.next=10,s.loadItems();case 10:return(0,v.default)(e,B,"Deleting Posts"),t.next=13,s.nuke();case 13:return(0,v.default)(e,B,"Loading Comments"),i=new(0,P.default)(r,n),t.next=17,i.loadItems();case 17:return(0,v.default)(e,B,"Deleting Comments"),t.next=20,i.nuke();case 20:(0,v.default)(e,B,"Done!"),document.getElementById("loading").classList.remove("loading");case 22:case"end":return t.stop()}}),t)})))()}}]),r}(C.Controller);function K(){var e=window.location.hash.replace("#","?");return new URLSearchParams(e)}function V(e){var t={};return document.cookie.split(";").forEach((function(e){var r=(0,D.default)(e.split("="),2),n=r[0],s=r[1];t[n.trim()]=s})),t[e]}function G(e){document.getElementById("loading").textContent=e}},{"@swc/helpers/src/_assert_this_initialized.mjs":"1hTTt","@swc/helpers/src/_async_to_generator.mjs":"d46FK","@swc/helpers/src/_class_call_check.mjs":"bcDJH","@swc/helpers/src/_class_private_field_get.mjs":"ax2sY","@swc/helpers/src/_class_private_field_init.mjs":"eHYn6","@swc/helpers/src/_class_private_field_set.mjs":"kiiWA","@swc/helpers/src/_class_private_method_get.mjs":"aKsR1","@swc/helpers/src/_class_private_method_init.mjs":"6V8Bd","@swc/helpers/src/_create_class.mjs":"e1EPh","@swc/helpers/src/_inherits.mjs":"kfOz5","@swc/helpers/src/_sliced_to_array.mjs":"3lmqd","@swc/helpers/src/_create_super.mjs":"dJHhu","regenerator-runtime":"achxx","@hotwired/stimulus":"51pPy","./nuke_controller/client":"4lDFi","./nuke_controller/commentHandler":"5dFWu","./nuke_controller/postHandler":"eVPMF","@parcel/transformer-js/src/esmodule-helpers.js":"3ieD1"}],ax2sY:[function(e,t,r){var n=e("@parcel/transformer-js/src/esmodule-helpers.js");n.defineInteropFlag(r);var s=e("./_class_extract_field_descriptor.mjs"),i=n.interopDefault(s),a=e("./_class_apply_descriptor_get.mjs"),o=n.interopDefault(a);r.default=function(e,t){var r=(0,i.default)(e,t,"get");return(0,o.default)(e,r)}},{"./_class_extract_field_descriptor.mjs":"1mE6X","./_class_apply_descriptor_get.mjs":"6CTks","@parcel/transformer-js/src/esmodule-helpers.js":"3ieD1"}],"1mE6X":[function(e,t,r){e("@parcel/transformer-js/src/esmodule-helpers.js").defineInteropFlag(r),r.default=function(e,t,r){if(!t.has(e))throw new TypeError("attempted to "+r+" private field on non-instance");return t.get(e)}},{"@parcel/transformer-js/src/esmodule-helpers.js":"3ieD1"}],"6CTks":[function(e,t,r){e("@parcel/transformer-js/src/esmodule-helpers.js").defineInteropFlag(r),r.default=function(e,t){return t.get?t.get.call(e):t.value}},{"@parcel/transformer-js/src/esmodule-helpers.js":"3ieD1"}],eHYn6:[function(e,t,r){var n=e("@parcel/transformer-js/src/esmodule-helpers.js");n.defineInteropFlag(r);var s=e("./_check_private_redeclaration.mjs"),i=n.interopDefault(s);r.default=function(e,t,r){(0,i.default)(e,t),t.set(e,r)}},{"./_check_private_redeclaration.mjs":"Q5RWi","@parcel/transformer-js/src/esmodule-helpers.js":"3ieD1"}],Q5RWi:[function(e,t,r){e("@parcel/transformer-js/src/esmodule-helpers.js").defineInteropFlag(r),r.default=function(e,t){if(t.has(e))throw new TypeError("Cannot initialize the same private elements twice on an object")}},{"@parcel/transformer-js/src/esmodule-helpers.js":"3ieD1"}],kiiWA:[function(e,t,r){var n=e("@parcel/transformer-js/src/esmodule-helpers.js");n.defineInteropFlag(r);var s=e("./_class_extract_field_descriptor.mjs"),i=n.interopDefault(s),a=e("./_class_apply_descriptor_set.mjs"),o=n.interopDefault(a);r.default=function(e,t,r){var n=(0,i.default)(e,t,"set");return(0,o.default)(e,n,r),r}},{"./_class_extract_field_descriptor.mjs":"1mE6X","./_class_apply_descriptor_set.mjs":"iXbpF","@parcel/transformer-js/src/esmodule-helpers.js":"3ieD1"}],iXbpF:[function(e,t,r){e("@parcel/transformer-js/src/esmodule-helpers.js").defineInteropFlag(r),r.default=function(e,t,r){if(t.set)t.set.call(e,r);else{if(!t.writable)throw new TypeError("attempted to set read only private field");t.value=r}}},{"@parcel/transformer-js/src/esmodule-helpers.js":"3ieD1"}],aKsR1:[function(e,t,r){e("@parcel/transformer-js/src/esmodule-helpers.js").defineInteropFlag(r),r.default=function(e,t,r){if(!t.has(e))throw new TypeError("attempted to get private field on non-instance");return r}},{"@parcel/transformer-js/src/esmodule-helpers.js":"3ieD1"}],"6V8Bd":[function(e,t,r){var n=e("@parcel/transformer-js/src/esmodule-helpers.js");n.defineInteropFlag(r);var s=e("./_check_private_redeclaration.mjs"),i=n.interopDefault(s);r.default=function(e,t){(0,i.default)(e,t),t.add(e)}},{"./_check_private_redeclaration.mjs":"Q5RWi","@parcel/transformer-js/src/esmodule-helpers.js":"3ieD1"}],"4lDFi":[function(e,t,r){var n=e("@parcel/transformer-js/src/esmodule-helpers.js");n.defineInteropFlag(r),n.export(r,"default",(function(){return g}));var s=e("@swc/helpers/src/_async_to_generator.mjs"),i=n.interopDefault(s),a=e("@swc/helpers/src/_class_call_check.mjs"),o=n.interopDefault(a),c=e("@swc/helpers/src/_class_private_method_get.mjs"),u=n.interopDefault(c),l=e("@swc/helpers/src/_class_private_method_init.mjs"),h=n.interopDefault(l),f=e("@swc/helpers/src/_create_class.mjs"),d=n.interopDefault(f),p=e("regenerator-runtime"),v=n.interopDefault(p),m=e("bottleneck"),_=new(0,n.interopDefault(m).default)({minTime:1e3}).wrap(fetch),y=new WeakSet,g=function(){"use strict";function e(t){(0,o.default)(this,e),(0,h.default)(this,y),this.token=t}return(0,d.default)(e,[{key:"getUser",value:function(e){var t=this;return(0,i.default)(v.default.mark((function r(){return v.default.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return r.abrupt("return",(0,u.default)(t,y,k).call(t,{url:"https://oauth.reddit.com/api/v1/me",method:"GET",callback:e}));case 1:case"end":return r.stop()}}),r)})))()}},{key:"getComments",value:function(e,t,r){var n=this;return(0,i.default)(v.default.mark((function s(){return v.default.wrap((function(s){for(;;)switch(s.prev=s.next){case 0:return s.abrupt("return",(0,u.default)(n,y,k).call(n,{url:"https://oauth.reddit.com/user/".concat(e,"/comments"),method:"GET",params:t,callback:r}));case 1:case"end":return s.stop()}}),s)})))()}},{key:"getPosts",value:function(e,t,r){var n=this;return(0,i.default)(v.default.mark((function s(){return v.default.wrap((function(s){for(;;)switch(s.prev=s.next){case 0:return s.abrupt("return",(0,u.default)(n,y,k).call(n,{url:"https://oauth.reddit.com/user/".concat(e,"/submitted"),method:"GET",params:t,callback:r}));case 1:case"end":return s.stop()}}),s)})))()}},{key:"editComment",value:function(e,t,r){var n=this;return(0,i.default)(v.default.mark((function s(){return v.default.wrap((function(s){for(;;)switch(s.prev=s.next){case 0:return s.abrupt("return",(0,u.default)(n,y,k).call(n,{url:"https://oauth.reddit.com/api/editusertext",method:"POST",params:{thing_id:"t1_".concat(e),text:t,api_type:"json"},callback:r}));case 1:case"end":return s.stop()}}),s)})))()}},{key:"deleteComment",value:function(e,t){var r=this;return(0,i.default)(v.default.mark((function n(){return v.default.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.abrupt("return",(0,u.default)(r,y,k).call(r,{url:"https://oauth.reddit.com/api/del",method:"POST",params:{id:"t1_".concat(e)},callback:t}));case 1:case"end":return n.stop()}}),n)})))()}},{key:"editPost",value:function(e,t,r){var n=this;return(0,i.default)(v.default.mark((function s(){return v.default.wrap((function(s){for(;;)switch(s.prev=s.next){case 0:return s.abrupt("return",(0,u.default)(n,y,k).call(n,{url:"https://oauth.reddit.com/api/editusertext",method:"POST",params:{thing_id:"t3_".concat(e),text:t,api_type:"json"},callback:r}));case 1:case"end":return s.stop()}}),s)})))()}},{key:"deletePost",value:function(e,t){var r=this;return(0,i.default)(v.default.mark((function n(){return v.default.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.abrupt("return",(0,u.default)(r,y,k).call(r,{url:"https://oauth.reddit.com/api/del",method:"POST",params:{id:"t3_".concat(e)},callback:t}));case 1:case"end":return n.stop()}}),n)})))()}}]),e}();function k(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.url,r=e.method,n=e.params,s=e.callback;if("POST"==r)return new Promise((function(e){return setTimeout(e,1e3)})).then((function(){return console.log(t)}));var i=new Headers;i.append("Authorization","Bearer ".concat(this.token," ")),i.append("Content-Type","application/json");var a={method:r,headers:i},o=new URL(t);for(var c in n)o.searchParams.append(c,n[c]);return _(o.href,a).then((function(e){return e.json()})).catch((function(e){return console.error(e)})).then((function(e){return"function"==typeof s&&s(e)}))}},{"@swc/helpers/src/_async_to_generator.mjs":"d46FK","@swc/helpers/src/_class_call_check.mjs":"bcDJH","@swc/helpers/src/_class_private_method_get.mjs":"aKsR1","@swc/helpers/src/_class_private_method_init.mjs":"6V8Bd","@swc/helpers/src/_create_class.mjs":"e1EPh","regenerator-runtime":"achxx",bottleneck:"d83S1","@parcel/transformer-js/src/esmodule-helpers.js":"3ieD1"}],d83S1:[function(e,t,r){"use strict";t.exports=e("./Bottleneck")},{"./Bottleneck":"7ZDSs"}],"7ZDSs":[function(e,t,r){var n=e("@parcel/transformer-js/src/esmodule-helpers.js"),s=e("@swc/helpers/src/_class_call_check.mjs"),i=n.interopDefault(s),a=e("@swc/helpers/src/_create_class.mjs"),o=n.interopDefault(a),c=e("@swc/helpers/src/_to_consumable_array.mjs"),u=n.interopDefault(c),l=e("regenerator-runtime"),h=n.interopDefault(l);function f(e,t){return v(e)||function(e,t){var r=[],n=!0,s=!1,i=void 0;try{for(var a,o=e[Symbol.iterator]();!(n=(a=o.next()).done)&&(r.push(a.value),!t||r.length!==t);n=!0);}catch(e){s=!0,i=e}finally{try{n||null==o.return||o.return()}finally{if(s)throw i}}return r}(e,t)||p()}function d(e){return v(e)||function(e){if(Symbol.iterator in Object(e)||"[object Arguments]"===Object.prototype.toString.call(e))return Array.from(e)}(e)||p()}function p(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}function v(e){if(Array.isArray(e))return e}function m(e,t,r,n,s,i,a){try{var o=e[i](a),c=o.value}catch(e){return void r(e)}o.done?t(c):Promise.resolve(c).then(n,s)}function _(e){return function(){var t=this,r=arguments;return new Promise((function(n,s){var i=e.apply(t,r);function a(e){m(i,n,s,a,o,"next",e)}function o(e){m(i,n,s,a,o,"throw",e)}a(void 0)}))}}var y,g,k,b,w,j,x,D,E,O=[].splice;E=e("./parser"),w=e("./Queues"),k=e("./Job"),b=e("./LocalDatastore"),j=e("./RedisDatastore"),g=e("./Events"),x=e("./States"),D=e("./Sync"),y=function(){var t=function(){function e(){for(var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},r=arguments.length,n=new Array(r>1?r-1:0),s=1;s<r;s++)n[s-1]=arguments[s];var a,o,c=this;(0,i.default)(this,e),this._addToQueue=this._addToQueue.bind(this),this._validateOptions(t,n),E.load(t,this.instanceDefaults,this),this._queues=new w(10),this._scheduled={},this._states=new x(["RECEIVED","QUEUED","RUNNING","EXECUTING"].concat(this.trackDoneStatus?["DONE"]:[])),this._limiter=null,this.Events=new g(this),this._submitLock=new D("submit",this.Promise),this._registerLock=new D("register",this.Promise),o=E.load(t,this.storeDefaults,{}),this._store=function(){if("redis"===this.datastore||"ioredis"===this.datastore||null!=this.connection)return a=E.load(t,this.redisStoreDefaults,{}),new j(this,o,a);if("local"===this.datastore)return a=E.load(t,this.localStoreDefaults,{}),new b(this,o,a);throw new e.prototype.BottleneckError("Invalid datastore type: ".concat(this.datastore))}.call(this),this._queues.on("leftzero",(function(){var e;return null!=(e=c._store.heartbeat)&&"function"==typeof e.ref?e.ref():void 0})),this._queues.on("zero",(function(){var e;return null!=(e=c._store.heartbeat)&&"function"==typeof e.unref?e.unref():void 0}))}return(0,o.default)(e,[{key:"_validateOptions",value:function(t,r){if(null==t||"object"!=typeof t||0!==r.length)throw new e.prototype.BottleneckError("Bottleneck v2 takes a single object argument. Refer to https://github.com/SGrondin/bottleneck#upgrading-to-v2 if you're upgrading from Bottleneck v1.")}},{key:"ready",value:function(){return this._store.ready}},{key:"clients",value:function(){return this._store.clients}},{key:"channel",value:function(){return"b_".concat(this.id)}},{key:"channel_client",value:function(){return"b_".concat(this.id,"_").concat(this._store.clientId)}},{key:"publish",value:function(e){return this._store.__publish__(e)}},{key:"disconnect",value:function(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];return this._store.__disconnect__(e)}},{key:"chain",value:function(e){return this._limiter=e,this}},{key:"queued",value:function(e){return this._queues.queued(e)}},{key:"clusterQueued",value:function(){return this._store.__queued__()}},{key:"empty",value:function(){return 0===this.queued()&&this._submitLock.isEmpty()}},{key:"running",value:function(){return this._store.__running__()}},{key:"done",value:function(){return this._store.__done__()}},{key:"jobStatus",value:function(e){return this._states.jobStatus(e)}},{key:"jobs",value:function(e){return this._states.statusJobs(e)}},{key:"counts",value:function(){return this._states.statusCounts()}},{key:"_randomIndex",value:function(){return Math.random().toString(36).slice(2)}},{key:"check",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1;return this._store.__check__(e)}},{key:"_clearGlobalState",value:function(e){return null!=this._scheduled[e]&&(clearTimeout(this._scheduled[e].expiration),delete this._scheduled[e],!0)}},{key:"_free",value:function(e,t,r,n){var s=this;return _(h.default.mark((function t(){var i,a,o;return h.default.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=1,t.next=4,s._store.__free__(e,r.weight);case 4:if(o=t.sent,a=o.running,s.Events.trigger("debug","Freed ".concat(r.id),n),0!==a||!s.empty()){t.next=9;break}return t.abrupt("return",s.Events.trigger("idle"));case 9:t.next=15;break;case 11:return t.prev=11,t.t0=t.catch(1),i=t.t0,t.abrupt("return",s.Events.trigger("error",i));case 15:case"end":return t.stop()}}),t,null,[[1,11]])})))()}},{key:"_run",value:function(e,t,r){var n,s,i,a=this;return t.doRun(),n=this._clearGlobalState.bind(this,e),i=this._run.bind(this,e,t),s=this._free.bind(this,e,t),this._scheduled[e]={timeout:setTimeout((function(){return t.doExecute(a._limiter,n,i,s)}),r),expiration:null!=t.options.expiration?setTimeout((function(){return t.doExpire(n,i,s)}),r+t.options.expiration):void 0,job:t}}},{key:"_drainOne",value:function(e){var t=this;return this._registerLock.schedule((function(){var r,n,s,i,a;if(0===t.queued())return t.Promise.resolve(null);a=t._queues.getFirst();var o=s=a.first();return i=o.options,r=o.args,null!=e&&i.weight>e?t.Promise.resolve(null):(t.Events.trigger("debug","Draining ".concat(i.id),{args:r,options:i}),n=t._randomIndex(),t._store.__register__(n,i.weight,i.expiration).then((function(e){var o,c=e.success,u=e.wait,l=e.reservoir;return t.Events.trigger("debug","Drained ".concat(i.id),{success:c,args:r,options:i}),c?(a.shift(),(o=t.empty())&&t.Events.trigger("empty"),0===l&&t.Events.trigger("depleted",o),t._run(n,s,u),t.Promise.resolve(i.weight)):t.Promise.resolve(null)})))}))}},{key:"_drainAll",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,r=this;return this._drainOne(e).then((function(n){var s;return null!=n?(s=null!=e?e-n:e,r._drainAll(s,t+n)):r.Promise.resolve(t)})).catch((function(e){return r.Events.trigger("error",e)}))}},{key:"_dropAllQueued",value:function(e){return this._queues.shiftAll((function(t){return t.doDrop({message:e})}))}},{key:"stop",value:function(){var t,r,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},s=this;return n=E.load(n,this.stopDefaults),r=function(e){var t;return t=function(){var t;return(t=s._states.counts)[0]+t[1]+t[2]+t[3]===e},new s.Promise((function(e,r){return t()?e():s.on("done",(function(){if(t())return s.removeAllListeners("done"),e()}))}))},t=n.dropWaitingJobs?(this._run=function(e,t){return t.doDrop({message:n.dropErrorMessage})},this._drainOne=function(){return s.Promise.resolve(null)},this._registerLock.schedule((function(){return s._submitLock.schedule((function(){var e,t,i;for(e in t=s._scheduled)i=t[e],"RUNNING"===s.jobStatus(i.job.options.id)&&(clearTimeout(i.timeout),clearTimeout(i.expiration),i.job.doDrop({message:n.dropErrorMessage}));return s._dropAllQueued(n.dropErrorMessage),r(0)}))}))):this.schedule({priority:9,weight:0},(function(){return r(1)})),this._receive=function(t){return t._reject(new e.prototype.BottleneckError(n.enqueueErrorMessage))},this.stop=function(){return s.Promise.reject(new e.prototype.BottleneckError("stop() has already been called"))},t}},{key:"_addToQueue",value:function(t){var r=this;return _(h.default.mark((function n(){var s,i,a,o,c,u,l,f;return h.default.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return s=t.args,o=t.options,n.prev=3,n.next=6,r._store.__submit__(r.queued(),o.weight);case 6:f=n.sent,c=f.reachedHWM,i=f.blocked,l=f.strategy,n.next=18;break;case 12:return n.prev=12,n.t0=n.catch(3),a=n.t0,r.Events.trigger("debug","Could not queue ".concat(o.id),{args:s,options:o,error:a}),t.doDrop({error:a}),n.abrupt("return",!1);case 18:if(!i){n.next=23;break}return t.doDrop(),n.abrupt("return",!0);case 23:if(!c){n.next=29;break}if(null!=(u=l===e.prototype.strategy.LEAK?r._queues.shiftLastFrom(o.priority):l===e.prototype.strategy.OVERFLOW_PRIORITY?r._queues.shiftLastFrom(o.priority+1):l===e.prototype.strategy.OVERFLOW?t:void 0)&&u.doDrop(),null!=u&&l!==e.prototype.strategy.OVERFLOW){n.next=29;break}return null==u&&t.doDrop(),n.abrupt("return",c);case 29:return t.doQueue(c,i),r._queues.push(t),n.next=33,r._drainAll();case 33:return n.abrupt("return",c);case 34:case"end":return n.stop()}}),n,null,[[3,12]])})))()}},{key:"_receive",value:function(t){return null!=this._states.jobStatus(t.options.id)?(t._reject(new e.prototype.BottleneckError("A job with the same id already exists (id=".concat(t.options.id,")"))),!1):(t.doReceive(),this._submitLock.schedule(this._addToQueue,t))}},{key:"submit",value:function(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];var n,s,i,a,o,c,l,h,p,v=this;"function"==typeof t[0]?(c=d(t),s=c[0],t=c.slice(1),l=f(O.call(t,-1),1),n=l[0],a=E.load({},this.jobDefaults)):(a=(h=d(t))[0],s=h[1],t=h.slice(2),p=f(O.call(t,-1),1),n=p[0],a=E.load(a,this.jobDefaults));return o=function(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];return new v.Promise((function(e,r){return s.apply(void 0,(0,u.default)(t).concat([function(){for(var t=arguments.length,n=new Array(t),s=0;s<t;s++)n[s]=arguments[s];return(null!=n[0]?r:e)(n)}]))}))},(i=new k(o,t,a,this.jobDefaults,this.rejectOnDrop,this.Events,this._states,this.Promise)).promise.then((function(e){return"function"==typeof n?n.apply(void 0,(0,u.default)(e)):void 0})).catch((function(e){return Array.isArray(e)?"function"==typeof n?n.apply(void 0,(0,u.default)(e)):void 0:"function"==typeof n?n(e):void 0})),this._receive(i)}},{key:"schedule",value:function(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];var n,s,i;if("function"==typeof t[0]){var a=t,o=d(a);i=o[0],t=o.slice(1),s={}}else{var c=t,u=d(c);s=u[0],i=u[1],t=u.slice(2)}return n=new k(i,t,s,this.jobDefaults,this.rejectOnDrop,this.Events,this._states,this.Promise),this._receive(n),n.promise}},{key:"wrap",value:function(e){var t,r;return t=this.schedule.bind(this),r=function(){for(var r=arguments.length,n=new Array(r),s=0;s<r;s++)n[s]=arguments[s];return t.apply(void 0,[e.bind(this)].concat((0,u.default)(n)))},r.withOptions=function(r){for(var n=arguments.length,s=new Array(n>1?n-1:0),i=1;i<n;i++)s[i-1]=arguments[i];return t.apply(void 0,[r,e].concat((0,u.default)(s)))},r}},{key:"updateSettings",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=this;return _(h.default.mark((function r(){return h.default.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return r.next=2,t._store.__updateSettings__(E.overwrite(e,t.storeDefaults));case 2:return E.overwrite(e,t.instanceDefaults,t),r.abrupt("return",t);case 4:case"end":return r.stop()}}),r)})))()}},{key:"currentReservoir",value:function(){return this._store.__currentReservoir__()}},{key:"incrementReservoir",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return this._store.__incrementReservoir__(e)}}]),e}();return t.default=t,t.Events=g,t.version=t.prototype.version=e("./version.json").version,t.strategy=t.prototype.strategy={LEAK:1,OVERFLOW:2,OVERFLOW_PRIORITY:4,BLOCK:3},t.BottleneckError=t.prototype.BottleneckError=e("./BottleneckError"),t.Group=t.prototype.Group=e("./Group"),t.RedisConnection=t.prototype.RedisConnection=e("./RedisConnection"),t.IORedisConnection=t.prototype.IORedisConnection=e("./IORedisConnection"),t.Batcher=t.prototype.Batcher=e("./Batcher"),t.prototype.jobDefaults={priority:5,weight:1,expiration:null,id:"<no-id>"},t.prototype.storeDefaults={maxConcurrent:null,minTime:0,highWater:null,strategy:t.prototype.strategy.LEAK,penalty:null,reservoir:null,reservoirRefreshInterval:null,reservoirRefreshAmount:null,reservoirIncreaseInterval:null,reservoirIncreaseAmount:null,reservoirIncreaseMaximum:null},t.prototype.localStoreDefaults={Promise:Promise,timeout:null,heartbeatInterval:250},t.prototype.redisStoreDefaults={Promise:Promise,timeout:null,heartbeatInterval:5e3,clientTimeout:1e4,Redis:null,clientOptions:{},clusterNodes:null,clearDatastore:!1,connection:null},t.prototype.instanceDefaults={datastore:"local",connection:null,id:"<no-id>",rejectOnDrop:!0,trackDoneStatus:!1,Promise:Promise},t.prototype.stopDefaults={enqueueErrorMessage:"This limiter has been stopped and cannot accept new jobs.",dropWaitingJobs:!0,dropErrorMessage:"This limiter has been stopped."},t}.call(void 0),t.exports=y},{"@swc/helpers/src/_class_call_check.mjs":"bcDJH","@swc/helpers/src/_create_class.mjs":"e1EPh","@swc/helpers/src/_to_consumable_array.mjs":"lp3rF","regenerator-runtime":"achxx","./parser":"2BgUG","./Queues":"1jcNX","./Job":"3cL4h","./LocalDatastore":"5eOhb","./RedisDatastore":"fLsTT","./Events":"atGPC","./States":"vqi7z","./Sync":"jNoa1","./version.json":"2ioVv","./BottleneckError":"bTksA","./Group":"atrI1","./RedisConnection":"btByZ","./IORedisConnection":"7LRob","./Batcher":"6ptSl","@parcel/transformer-js/src/esmodule-helpers.js":"3ieD1"}],"2BgUG":[function(e,t,r){"use strict";r.load=function(e,t){var r,n,s,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};for(r in t)s=t[r],i[r]=null!=(n=e[r])?n:s;return i},r.overwrite=function(e,t){var r,n,s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};for(r in e)n=e[r],void 0!==t[r]&&(s[r]=n);return s}},{}],"1jcNX":[function(e,t,r){var n,s,i,a=e("@parcel/transformer-js/src/esmodule-helpers.js"),o=e("@swc/helpers/src/_class_call_check.mjs"),c=a.interopDefault(o),u=e("@swc/helpers/src/_create_class.mjs"),l=a.interopDefault(u);n=e("./DLList"),s=e("./Events"),i=function(){function e(t){(0,c.default)(this,e),this.Events=new s(this),this._length=0,this._lists=function(){var e,r,s,i=this;for(s=[],e=1,r=t;1<=r?e<=r:e>=r;1<=r?++e:--e)s.push(new n((function(){return i.incr()}),(function(){return i.decr()})));return s}.call(this)}return(0,l.default)(e,[{key:"incr",value:function(){if(0==this._length++)return this.Events.trigger("leftzero")}},{key:"decr",value:function(){if(0==--this._length)return this.Events.trigger("zero")}},{key:"push",value:function(e){return this._lists[e.options.priority].push(e)}},{key:"queued",value:function(e){return null!=e?this._lists[e].length:this._length}},{key:"shiftAll",value:function(e){return this._lists.forEach((function(t){return t.forEachShift(e)}))}},{key:"getFirst",value:function(){var e,t,r,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this._lists;for(e=0,t=n.length;e<t;e++)if((r=n[e]).length>0)return r;return[]}},{key:"shiftLastFrom",value:function(e){return this.getFirst(this._lists.slice(e).reverse()).shift()}}]),e}(),t.exports=i},{"@swc/helpers/src/_class_call_check.mjs":"bcDJH","@swc/helpers/src/_create_class.mjs":"e1EPh","./DLList":"inXX9","./Events":"atGPC","@parcel/transformer-js/src/esmodule-helpers.js":"3ieD1"}],inXX9:[function(e,t,r){var n,s=e("@parcel/transformer-js/src/esmodule-helpers.js"),i=e("@swc/helpers/src/_class_call_check.mjs"),a=s.interopDefault(i),o=e("@swc/helpers/src/_create_class.mjs"),c=s.interopDefault(o);n=function(){function e(t,r){(0,a.default)(this,e),this.incr=t,this.decr=r,this._first=null,this._last=null,this.length=0}return(0,c.default)(e,[{key:"push",value:function(e){var t;this.length++,"function"==typeof this.incr&&this.incr(),t={value:e,prev:this._last,next:null},null!=this._last?(this._last.next=t,this._last=t):this._first=this._last=t}},{key:"shift",value:function(){var e;if(null!=this._first)return this.length--,"function"==typeof this.decr&&this.decr(),e=this._first.value,null!=(this._first=this._first.next)?this._first.prev=null:this._last=null,e}},{key:"first",value:function(){if(null!=this._first)return this._first.value}},{key:"getArray",value:function(){var e,t,r;for(e=this._first,r=[];null!=e;)r.push((t=e,e=e.next,t.value));return r}},{key:"forEachShift",value:function(e){var t;for(t=this.shift();null!=t;)e(t),t=this.shift()}},{key:"debug",value:function(){var e,t,r,n,s;for(e=this._first,s=[];null!=e;)s.push((t=e,e=e.next,{value:t.value,prev:null!=(r=t.prev)?r.value:void 0,next:null!=(n=t.next)?n.value:void 0}));return s}}]),e}(),t.exports=n},{"@swc/helpers/src/_class_call_check.mjs":"bcDJH","@swc/helpers/src/_create_class.mjs":"e1EPh","@parcel/transformer-js/src/esmodule-helpers.js":"3ieD1"}],atGPC:[function(e,t,r){var n,s=e("@parcel/transformer-js/src/esmodule-helpers.js"),i=e("@swc/helpers/src/_class_call_check.mjs"),a=s.interopDefault(i),o=e("@swc/helpers/src/_create_class.mjs"),c=s.interopDefault(o),u=e("@swc/helpers/src/_to_consumable_array.mjs"),l=s.interopDefault(u),h=e("regenerator-runtime"),f=s.interopDefault(h);function d(e,t,r,n,s,i,a){try{var o=e[i](a),c=o.value}catch(e){return void r(e)}o.done?t(c):Promise.resolve(c).then(n,s)}function p(e){return function(){var t=this,r=arguments;return new Promise((function(n,s){var i=e.apply(t,r);function a(e){d(i,n,s,a,o,"next",e)}function o(e){d(i,n,s,a,o,"throw",e)}a(void 0)}))}}n=function(){function e(t){var r=this;if((0,a.default)(this,e),this.instance=t,this._events={},null!=this.instance.on||null!=this.instance.once||null!=this.instance.removeAllListeners)throw new Error("An Emitter already exists for this object");this.instance.on=function(e,t){return r._addListener(e,"many",t)},this.instance.once=function(e,t){return r._addListener(e,"once",t)},this.instance.removeAllListeners=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;return null!=e?delete r._events[e]:r._events={}}}return(0,c.default)(e,[{key:"_addListener",value:function(e,t,r){var n;return null==(n=this._events)[e]&&(n[e]=[]),this._events[e].push({cb:r,status:t}),this.instance}},{key:"listenerCount",value:function(e){return null!=this._events[e]?this._events[e].length:0}},{key:"trigger",value:function(e){for(var t=arguments.length,r=new Array(t>1?t-1:0),n=1;n<t;n++)r[n-1]=arguments[n];var s=this;return p(f.default.mark((function t(){var n,i;return f.default.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(t.prev=1,"debug"!==e&&s.trigger("debug","Event triggered: ".concat(e),r),null!=s._events[e]){t.next=5;break}return t.abrupt("return");case 5:return s._events[e]=s._events[e].filter((function(e){return"none"!==e.status})),i=s._events[e].map(function(){var e=p(f.default.mark((function e(t){var n,i,a;return f.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if("none"!==t.status){e.next=3;break}return e.abrupt("return");case 3:if("once"===t.status&&(t.status="none"),e.prev=4,"function"!=typeof(null!=(i="function"==typeof t.cb?(a=t).cb.apply(a,(0,l.default)(r)):void 0)?i.then:void 0)){e.next=13;break}return e.next=10,i;case 10:return e.abrupt("return",e.sent);case 13:return e.abrupt("return",i);case 14:e.next=21;break;case 16:return e.prev=16,e.t0=e.catch(4),n=e.t0,s.trigger("error",n),e.abrupt("return",null);case 21:case"end":return e.stop()}}),e,null,[[4,16]])})));return function(t){return e.apply(this,arguments)}}()),t.next=9,Promise.all(i);case 9:return t.abrupt("return",t.sent.find((function(e){return null!=e})));case 12:return t.prev=12,t.t0=t.catch(1),n=t.t0,s.trigger("error",n),t.abrupt("return",null);case 17:case"end":return t.stop()}}),t,null,[[1,12]])})))()}}]),e}(),t.exports=n},{"@swc/helpers/src/_class_call_check.mjs":"bcDJH","@swc/helpers/src/_create_class.mjs":"e1EPh","@swc/helpers/src/_to_consumable_array.mjs":"lp3rF","regenerator-runtime":"achxx","@parcel/transformer-js/src/esmodule-helpers.js":"3ieD1"}],"3cL4h":[function(e,t,r){var n,s,i,a=e("@parcel/transformer-js/src/esmodule-helpers.js"),o=e("@swc/helpers/src/_class_call_check.mjs"),c=a.interopDefault(o),u=e("@swc/helpers/src/_create_class.mjs"),l=a.interopDefault(u),h=e("@swc/helpers/src/_to_consumable_array.mjs"),f=a.interopDefault(h),d=e("regenerator-runtime"),p=a.interopDefault(d);function v(e,t,r,n,s,i,a){try{var o=e[i](a),c=o.value}catch(e){return void r(e)}o.done?t(c):Promise.resolve(c).then(n,s)}function m(e){return function(){var t=this,r=arguments;return new Promise((function(n,s){var i=e.apply(t,r);function a(e){v(i,n,s,a,o,"next",e)}function o(e){v(i,n,s,a,o,"throw",e)}a(void 0)}))}}i=e("./parser"),n=e("./BottleneckError"),s=function(){function e(t,r,n,s,a,o,u,l){var h=this;(0,c.default)(this,e),this.task=t,this.args=r,this.rejectOnDrop=a,this.Events=o,this._states=u,this.Promise=l,this.options=i.load(n,s),this.options.priority=this._sanitizePriority(this.options.priority),this.options.id===s.id&&(this.options.id="".concat(this.options.id,"-").concat(this._randomIndex())),this.promise=new this.Promise((function(e,t){h._resolve=e,h._reject=t})),this.retryCount=0}return(0,l.default)(e,[{key:"_sanitizePriority",value:function(e){var t;return(t=~~e!==e?5:e)<0?0:t>9?9:t}},{key:"_randomIndex",value:function(){return Math.random().toString(36).slice(2)}},{key:"doDrop",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.error,r=e.message,s=void 0===r?"This job has been dropped by Bottleneck":r;return!!this._states.remove(this.options.id)&&(this.rejectOnDrop&&this._reject(null!=t?t:new n(s)),this.Events.trigger("dropped",{args:this.args,options:this.options,task:this.task,promise:this.promise}),!0)}},{key:"_assertStatus",value:function(e){var t;if((t=this._states.jobStatus(this.options.id))!==e&&("DONE"!==e||null!==t))throw new n("Invalid job status ".concat(t,", expected ").concat(e,". Please open an issue at https://github.com/SGrondin/bottleneck/issues"))}},{key:"doReceive",value:function(){return this._states.start(this.options.id),this.Events.trigger("received",{args:this.args,options:this.options})}},{key:"doQueue",value:function(e,t){return this._assertStatus("RECEIVED"),this._states.next(this.options.id),this.Events.trigger("queued",{args:this.args,options:this.options,reachedHWM:e,blocked:t})}},{key:"doRun",value:function(){return 0===this.retryCount?(this._assertStatus("QUEUED"),this._states.next(this.options.id)):this._assertStatus("EXECUTING"),this.Events.trigger("scheduled",{args:this.args,options:this.options})}},{key:"doExecute",value:function(e,t,r,n){var s=this;return m(p.default.mark((function i(){var a,o,c,u,l;return p.default.wrap((function(i){for(;;)switch(i.prev=i.next){case 0:return 0===s.retryCount?(s._assertStatus("RUNNING"),s._states.next(s.options.id)):s._assertStatus("EXECUTING"),o={args:s.args,options:s.options,retryCount:s.retryCount},s.Events.trigger("executing",o),i.prev=4,i.next=8,null!=e?(u=e).schedule.apply(u,[s.options,s.task].concat((0,f.default)(s.args))):(l=s).task.apply(l,(0,f.default)(s.args));case 8:if(c=i.sent,!t()){i.next=15;break}return s.doDone(o),i.next=13,n(s.options,o);case 13:return s._assertStatus("DONE"),i.abrupt("return",s._resolve(c));case 15:i.next=21;break;case 17:return i.prev=17,i.t0=i.catch(4),a=i.t0,i.abrupt("return",s._onFailure(a,o,t,r,n));case 21:case"end":return i.stop()}}),i,null,[[4,17]])})))()}},{key:"doExpire",value:function(e,t,r){var s,i;return this._states.jobStatus("RUNNING"===this.options.id)&&this._states.next(this.options.id),this._assertStatus("EXECUTING"),i={args:this.args,options:this.options,retryCount:this.retryCount},s=new n("This job timed out after ".concat(this.options.expiration," ms.")),this._onFailure(s,i,e,t,r)}},{key:"_onFailure",value:function(e,t,r,n,s){var i=this;return m(p.default.mark((function a(){var o,c;return p.default.wrap((function(a){for(;;)switch(a.prev=a.next){case 0:if(!r()){a.next=17;break}return a.next=4,i.Events.trigger("failed",e,t);case 4:if(null==(o=a.sent)){a.next=12;break}return c=~~o,i.Events.trigger("retry","Retrying ".concat(i.options.id," after ").concat(c," ms"),t),i.retryCount++,a.abrupt("return",n(c));case 12:return i.doDone(t),a.next=15,s(i.options,t);case 15:return i._assertStatus("DONE"),a.abrupt("return",i._reject(e));case 17:case"end":return a.stop()}}),a)})))()}},{key:"doDone",value:function(e){return this._assertStatus("EXECUTING"),this._states.next(this.options.id),this.Events.trigger("done",e)}}]),e}(),t.exports=s},{"@swc/helpers/src/_class_call_check.mjs":"bcDJH","@swc/helpers/src/_create_class.mjs":"e1EPh","@swc/helpers/src/_to_consumable_array.mjs":"lp3rF","regenerator-runtime":"achxx","./parser":"2BgUG","./BottleneckError":"bTksA","@parcel/transformer-js/src/esmodule-helpers.js":"3ieD1"}],bTksA:[function(e,t,r){var n,s=e("@parcel/transformer-js/src/esmodule-helpers.js"),i=e("@swc/helpers/src/_class_call_check.mjs"),a=s.interopDefault(i),o=e("@swc/helpers/src/_inherits.mjs"),c=s.interopDefault(o),u=e("@swc/helpers/src/_wrap_native_super.mjs"),l=s.interopDefault(u),h=e("@swc/helpers/src/_create_super.mjs"),f=s.interopDefault(h);n=function(e){(0,c.default)(r,e);var t=(0,f.default)(r);function r(){return(0,a.default)(this,r),t.apply(this,arguments)}return r}((0,l.default)(Error)),t.exports=n},{"@swc/helpers/src/_class_call_check.mjs":"bcDJH","@swc/helpers/src/_inherits.mjs":"kfOz5","@swc/helpers/src/_wrap_native_super.mjs":"jgQkv","@swc/helpers/src/_create_super.mjs":"dJHhu","@parcel/transformer-js/src/esmodule-helpers.js":"3ieD1"}],jgQkv:[function(e,t,r){var n=e("@parcel/transformer-js/src/esmodule-helpers.js");n.defineInteropFlag(r);var s=e("./_construct.mjs"),i=n.interopDefault(s),a=e("./_is_native_function.mjs"),o=n.interopDefault(a),c=e("./_get_prototype_of.mjs"),u=n.interopDefault(c),l=e("./_set_prototype_of.mjs"),h=n.interopDefault(l);function f(e){var t="function"==typeof Map?new Map:void 0;return f=function(e){if(null===e||!(0,o.default)(e))return e;if("function"!=typeof e)throw new TypeError("Super expression must either be null or a function");if(void 0!==t){if(t.has(e))return t.get(e);t.set(e,r)}function r(){return(0,i.default)(e,arguments,(0,u.default)(this).constructor)}return r.prototype=Object.create(e.prototype,{constructor:{value:r,enumerable:!1,writable:!0,configurable:!0}}),(0,h.default)(r,e)},f(e)}r.default=function(e){return f(e)}},{"./_construct.mjs":"b0YbA","./_is_native_function.mjs":"b0Z0d","./_get_prototype_of.mjs":"1gzL0","./_set_prototype_of.mjs":"dS33n","@parcel/transformer-js/src/esmodule-helpers.js":"3ieD1"}],b0YbA:[function(e,t,r){var n=e("@parcel/transformer-js/src/esmodule-helpers.js");n.defineInteropFlag(r);var s=e("./_set_prototype_of.mjs"),i=n.interopDefault(s);function a(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}function o(e,t,r){return o=a()?Reflect.construct:function(e,t,r){var n=[null];n.push.apply(n,t);var s=new(Function.bind.apply(e,n));return r&&(0,i.default)(s,r.prototype),s},o.apply(null,arguments)}r.default=function(e,t,r){return o.apply(null,arguments)}},{"./_set_prototype_of.mjs":"dS33n","@parcel/transformer-js/src/esmodule-helpers.js":"3ieD1"}],b0Z0d:[function(e,t,r){e("@parcel/transformer-js/src/esmodule-helpers.js").defineInteropFlag(r),r.default=function(e){return-1!==Function.toString.call(e).indexOf("[native code]")}},{"@parcel/transformer-js/src/esmodule-helpers.js":"3ieD1"}],"5eOhb":[function(e,t,r){var n,s,i,a=e("@parcel/transformer-js/src/esmodule-helpers.js"),o=e("@swc/helpers/src/_class_call_check.mjs"),c=a.interopDefault(o),u=e("@swc/helpers/src/_create_class.mjs"),l=a.interopDefault(u),h=e("regenerator-runtime"),f=a.interopDefault(h);function d(e,t,r,n,s,i,a){try{var o=e[i](a),c=o.value}catch(e){return void r(e)}o.done?t(c):Promise.resolve(c).then(n,s)}function p(e){return function(){var t=this,r=arguments;return new Promise((function(n,s){var i=e.apply(t,r);function a(e){d(i,n,s,a,o,"next",e)}function o(e){d(i,n,s,a,o,"throw",e)}a(void 0)}))}}i=e("./parser"),n=e("./BottleneckError"),s=function(){function e(t,r,n){(0,c.default)(this,e),this.instance=t,this.storeOptions=r,this.clientId=this.instance._randomIndex(),i.load(n,n,this),this._nextRequest=this._lastReservoirRefresh=this._lastReservoirIncrease=Date.now(),this._running=0,this._done=0,this._unblockTime=0,this.ready=this.Promise.resolve(),this.clients={},this._startHeartbeat()}return(0,l.default)(e,[{key:"_startHeartbeat",value:function(){var e,t=this;return null==this.heartbeat&&(null!=this.storeOptions.reservoirRefreshInterval&&null!=this.storeOptions.reservoirRefreshAmount||null!=this.storeOptions.reservoirIncreaseInterval&&null!=this.storeOptions.reservoirIncreaseAmount)?"function"==typeof(e=this.heartbeat=setInterval((function(){var e,r,n,s,i;if(s=Date.now(),null!=t.storeOptions.reservoirRefreshInterval&&s>=t._lastReservoirRefresh+t.storeOptions.reservoirRefreshInterval&&(t._lastReservoirRefresh=s,t.storeOptions.reservoir=t.storeOptions.reservoirRefreshAmount,t.instance._drainAll(t.computeCapacity())),null!=t.storeOptions.reservoirIncreaseInterval&&s>=t._lastReservoirIncrease+t.storeOptions.reservoirIncreaseInterval){var a=t.storeOptions;if(e=a.reservoirIncreaseAmount,n=a.reservoirIncreaseMaximum,i=a.reservoir,t._lastReservoirIncrease=s,(r=null!=n?Math.min(e,n-i):e)>0)return t.storeOptions.reservoir+=r,t.instance._drainAll(t.computeCapacity())}}),this.heartbeatInterval)).unref?e.unref():void 0:clearInterval(this.heartbeat)}},{key:"__publish__",value:function(e){var t=this;return p(f.default.mark((function r(){return f.default.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return r.next=2,t.yieldLoop();case 2:return r.abrupt("return",t.instance.Events.trigger("message",e.toString()));case 3:case"end":return r.stop()}}),r)})))()}},{key:"__disconnect__",value:function(e){var t=this;return p(f.default.mark((function e(){return f.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.yieldLoop();case 2:return clearInterval(t.heartbeat),e.abrupt("return",t.Promise.resolve());case 4:case"end":return e.stop()}}),e)})))()}},{key:"yieldLoop",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return new this.Promise((function(t,r){return setTimeout(t,e)}))}},{key:"computePenalty",value:function(){var e;return null!=(e=this.storeOptions.penalty)?e:15*this.storeOptions.minTime||5e3}},{key:"__updateSettings__",value:function(e){var t=this;return p(f.default.mark((function r(){return f.default.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return r.next=2,t.yieldLoop();case 2:return i.overwrite(e,e,t.storeOptions),t._startHeartbeat(),t.instance._drainAll(t.computeCapacity()),r.abrupt("return",!0);case 6:case"end":return r.stop()}}),r)})))()}},{key:"__running__",value:function(){var e=this;return p(f.default.mark((function t(){return f.default.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,e.yieldLoop();case 2:return t.abrupt("return",e._running);case 3:case"end":return t.stop()}}),t)})))()}},{key:"__queued__",value:function(){var e=this;return p(f.default.mark((function t(){return f.default.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,e.yieldLoop();case 2:return t.abrupt("return",e.instance.queued());case 3:case"end":return t.stop()}}),t)})))()}},{key:"__done__",value:function(){var e=this;return p(f.default.mark((function t(){return f.default.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,e.yieldLoop();case 2:return t.abrupt("return",e._done);case 3:case"end":return t.stop()}}),t)})))()}},{key:"__groupCheck__",value:function(e){var t=this;return p(f.default.mark((function r(){return f.default.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return r.next=2,t.yieldLoop();case 2:return r.abrupt("return",t._nextRequest+t.timeout<e);case 3:case"end":return r.stop()}}),r)})))()}},{key:"computeCapacity",value:function(){var e,t,r=this.storeOptions;return e=r.maxConcurrent,t=r.reservoir,null!=e&&null!=t?Math.min(e-this._running,t):null!=e?e-this._running:null!=t?t:null}},{key:"conditionsCheck",value:function(e){var t;return null==(t=this.computeCapacity())||e<=t}},{key:"__incrementReservoir__",value:function(e){var t=this;return p(f.default.mark((function r(){var n;return f.default.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return r.next=3,t.yieldLoop();case 3:return n=t.storeOptions.reservoir+=e,t.instance._drainAll(t.computeCapacity()),r.abrupt("return",n);case 6:case"end":return r.stop()}}),r)})))()}},{key:"__currentReservoir__",value:function(){var e=this;return p(f.default.mark((function t(){return f.default.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,e.yieldLoop();case 2:return t.abrupt("return",e.storeOptions.reservoir);case 3:case"end":return t.stop()}}),t)})))()}},{key:"isBlocked",value:function(e){return this._unblockTime>=e}},{key:"check",value:function(e,t){return this.conditionsCheck(e)&&this._nextRequest-t<=0}},{key:"__check__",value:function(e){var t=this;return p(f.default.mark((function r(){var n;return f.default.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return r.next=3,t.yieldLoop();case 3:return n=Date.now(),r.abrupt("return",t.check(e,n));case 5:case"end":return r.stop()}}),r)})))()}},{key:"__register__",value:function(e,t,r){var n=this;return p(f.default.mark((function e(){var r,s;return f.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=3,n.yieldLoop();case 3:if(r=Date.now(),!n.conditionsCheck(t)){e.next=12;break}return n._running+=t,null!=n.storeOptions.reservoir&&(n.storeOptions.reservoir-=t),s=Math.max(n._nextRequest-r,0),n._nextRequest=r+s+n.storeOptions.minTime,e.abrupt("return",{success:!0,wait:s,reservoir:n.storeOptions.reservoir});case 12:return e.abrupt("return",{success:!1});case 13:case"end":return e.stop()}}),e)})))()}},{key:"strategyIsBlock",value:function(){return 3===this.storeOptions.strategy}},{key:"__submit__",value:function(e,t){var r=this;return p(f.default.mark((function s(){var i,a,o;return f.default.wrap((function(s){for(;;)switch(s.prev=s.next){case 0:return s.next=3,r.yieldLoop();case 3:if(!(null!=r.storeOptions.maxConcurrent&&t>r.storeOptions.maxConcurrent)){s.next=5;break}throw new n("Impossible to add a job having a weight of ".concat(t," to a limiter having a maxConcurrent setting of ").concat(r.storeOptions.maxConcurrent));case 5:return a=Date.now(),o=null!=r.storeOptions.highWater&&e===r.storeOptions.highWater&&!r.check(t,a),(i=r.strategyIsBlock()&&(o||r.isBlocked(a)))&&(r._unblockTime=a+r.computePenalty(),r._nextRequest=r._unblockTime+r.storeOptions.minTime,r.instance._dropAllQueued()),s.abrupt("return",{reachedHWM:o,blocked:i,strategy:r.storeOptions.strategy});case 10:case"end":return s.stop()}}),s)})))()}},{key:"__free__",value:function(e,t){var r=this;return p(f.default.mark((function e(){return f.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,r.yieldLoop();case 2:return r._running-=t,r._done+=t,r.instance._drainAll(r.computeCapacity()),e.abrupt("return",{running:r._running});case 6:case"end":return e.stop()}}),e)})))()}}]),e}(),t.exports=s},{"@swc/helpers/src/_class_call_check.mjs":"bcDJH","@swc/helpers/src/_create_class.mjs":"e1EPh","regenerator-runtime":"achxx","./parser":"2BgUG","./BottleneckError":"bTksA","@parcel/transformer-js/src/esmodule-helpers.js":"3ieD1"}],fLsTT:[function(e,t,r){var n,s,i,a,o,c=e("@parcel/transformer-js/src/esmodule-helpers.js"),u=e("@swc/helpers/src/_class_call_check.mjs"),l=c.interopDefault(u),h=e("@swc/helpers/src/_create_class.mjs"),f=c.interopDefault(h),d=e("@swc/helpers/src/_to_consumable_array.mjs"),p=c.interopDefault(d),v=e("regenerator-runtime"),m=c.interopDefault(v);function _(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var r=[],n=!0,s=!1,i=void 0;try{for(var a,o=e[Symbol.iterator]();!(n=(a=o.next()).done)&&(r.push(a.value),!t||r.length!==t);n=!0);}catch(e){s=!0,i=e}finally{try{n||null==o.return||o.return()}finally{if(s)throw i}}return r}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}()}function y(e,t,r,n,s,i,a){try{var o=e[i](a),c=o.value}catch(e){return void r(e)}o.done?t(c):Promise.resolve(c).then(n,s)}function g(e){return function(){var t=this,r=arguments;return new Promise((function(n,s){var i=e.apply(t,r);function a(e){y(i,n,s,a,o,"next",e)}function o(e){y(i,n,s,a,o,"throw",e)}a(void 0)}))}}o=e("./parser"),n=e("./BottleneckError"),i=e("./RedisConnection"),s=e("./IORedisConnection"),a=function(){function e(t,r,n){var a=this;(0,l.default)(this,e),this.instance=t,this.storeOptions=r,this.originalId=this.instance.id,this.clientId=this.instance._randomIndex(),o.load(n,n,this),this.clients={},this.capacityPriorityCounters={},this.sharedConnection=null!=this.connection,null==this.connection&&(this.connection="redis"===this.instance.datastore?new i({Redis:this.Redis,clientOptions:this.clientOptions,Promise:this.Promise,Events:this.instance.Events}):"ioredis"===this.instance.datastore?new s({Redis:this.Redis,clientOptions:this.clientOptions,clusterNodes:this.clusterNodes,Promise:this.Promise,Events:this.instance.Events}):void 0),this.instance.connection=this.connection,this.instance.datastore=this.connection.datastore,this.ready=this.connection.ready.then((function(e){return a.clients=e,a.runScript("init",a.prepareInitSettings(a.clearDatastore))})).then((function(){return a.connection.__addLimiter__(a.instance)})).then((function(){return a.runScript("register_client",[a.instance.queued()])})).then((function(){var e;return"function"==typeof(e=a.heartbeat=setInterval((function(){return a.runScript("heartbeat",[]).catch((function(e){return a.instance.Events.trigger("error",e)}))}),a.heartbeatInterval)).unref&&e.unref(),a.clients}))}return(0,f.default)(e,[{key:"__publish__",value:function(e){var t=this;return g(m.default.mark((function r(){var n,s;return m.default.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return r.next=3,t.ready;case 3:return s=r.sent,n=s.client,r.abrupt("return",n.publish(t.instance.channel(),"message:".concat(e.toString())));case 6:case"end":return r.stop()}}),r)})))()}},{key:"onMessage",value:function(e,t){var r=this;return g(m.default.mark((function e(){var n,s,i,a,o,c,u,l,h,f,d,p,v;return m.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=1,u=t.indexOf(":"),d=[t.slice(0,u),t.slice(u+1)],i=d[1],"capacity"!==(f=d[0])){e.next=12;break}return e.next=9,r.instance._drainAll(i.length>0?~~i:void 0);case 9:case 26:case 45:return e.abrupt("return",e.sent);case 12:if("capacity-priority"!==f){e.next=38;break}if(p=i.split(":"),v=_(p,3),h=v[0],l=v[1],s=v[2],n=h.length>0?~~h:void 0,l!==r.clientId){e.next=29;break}return e.next=22,r.instance._drainAll(n);case 22:return a=e.sent,c=null!=n?n-(a||0):"",e.next=26,r.clients.client.publish(r.instance.channel(),"capacity-priority:".concat(c,"::").concat(s));case 29:if(""!==l){e.next=35;break}return clearTimeout(r.capacityPriorityCounters[s]),delete r.capacityPriorityCounters[s],e.abrupt("return",r.instance._drainAll(n));case 35:return e.abrupt("return",r.capacityPriorityCounters[s]=setTimeout(g(m.default.mark((function e(){var t;return m.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=1,delete r.capacityPriorityCounters[s],e.next=5,r.runScript("blacklist_client",[l]);case 5:return e.next=7,r.instance._drainAll(n);case 7:return e.abrupt("return",e.sent);case 10:return e.prev=10,e.t0=e.catch(1),t=e.t0,e.abrupt("return",r.instance.Events.trigger("error",t));case 14:case"end":return e.stop()}}),e,null,[[1,10]])}))),1e3));case 36:e.next=46;break;case 38:if("message"!==f){e.next=42;break}return e.abrupt("return",r.instance.Events.trigger("message",i));case 42:if("blocked"!==f){e.next=46;break}return e.next=45,r.instance._dropAllQueued();case 46:e.next=52;break;case 48:return e.prev=48,e.t0=e.catch(1),o=e.t0,e.abrupt("return",r.instance.Events.trigger("error",o));case 52:case"end":return e.stop()}}),e,null,[[1,48]])})))()}},{key:"__disconnect__",value:function(e){return clearInterval(this.heartbeat),this.sharedConnection?this.connection.__removeLimiter__(this.instance):this.connection.disconnect(e)}},{key:"runScript",value:function(e,t){var r=this;return g(m.default.mark((function n(){var s;return m.default.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(s=this,"init"===e||"register_client"===e){n.next=4;break}return n.next=4,r.ready;case 4:return n.abrupt("return",new r.Promise((function(n,i){var a,o;return a=[Date.now(),r.clientId].concat(t),r.instance.Events.trigger("debug","Calling Redis script: ".concat(e,".lua"),a),o=r.connection.__scriptArgs__(e,r.originalId,a,(function(e,t){return null!=e?i(e):n(t)})),r.connection.__scriptFn__(e).apply(s,(0,p.default)(o))})).catch((function(n){return"SETTINGS_KEY_NOT_FOUND"===n.message?"heartbeat"===e?r.Promise.resolve():r.runScript("init",r.prepareInitSettings(!1)).then((function(){return r.runScript(e,t)})):"UNKNOWN_CLIENT"===n.message?r.runScript("register_client",[r.instance.queued()]).then((function(){return r.runScript(e,t)})):r.Promise.reject(n)})));case 5:case"end":return n.stop()}}),n,this)})))()}},{key:"prepareArray",value:function(e){var t,r,n,s;for(n=[],t=0,r=e.length;t<r;t++)s=e[t],n.push(null!=s?s.toString():"");return n}},{key:"prepareObject",value:function(e){var t,r,n;for(r in t=[],e)n=e[r],t.push(r,null!=n?n.toString():"");return t}},{key:"prepareInitSettings",value:function(e){var t;return(t=this.prepareObject(Object.assign({},this.storeOptions,{id:this.originalId,version:this.instance.version,groupTimeout:this.timeout,clientTimeout:this.clientTimeout}))).unshift(e?1:0,this.instance.version),t}},{key:"convertBool",value:function(e){return!!e}},{key:"__updateSettings__",value:function(e){var t=this;return g(m.default.mark((function r(){return m.default.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return r.next=2,t.runScript("update_settings",t.prepareObject(e));case 2:return r.abrupt("return",o.overwrite(e,e,t.storeOptions));case 3:case"end":return r.stop()}}),r)})))()}},{key:"__running__",value:function(){return this.runScript("running",[])}},{key:"__queued__",value:function(){return this.runScript("queued",[])}},{key:"__done__",value:function(){return this.runScript("done",[])}},{key:"__groupCheck__",value:function(){var e=this;return g(m.default.mark((function t(){return m.default.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.t0=e,t.next=3,e.runScript("group_check",[]);case 3:return t.t1=t.sent,t.abrupt("return",t.t0.convertBool.call(t.t0,t.t1));case 5:case"end":return t.stop()}}),t)})))()}},{key:"__incrementReservoir__",value:function(e){return this.runScript("increment_reservoir",[e])}},{key:"__currentReservoir__",value:function(){return this.runScript("current_reservoir",[])}},{key:"__check__",value:function(e){var t=this;return g(m.default.mark((function r(){return m.default.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return r.t0=t,r.next=3,t.runScript("check",t.prepareArray([e]));case 3:return r.t1=r.sent,r.abrupt("return",r.t0.convertBool.call(r.t0,r.t1));case 5:case"end":return r.stop()}}),r)})))()}},{key:"__register__",value:function(e,t,r){var n=this;return g(m.default.mark((function s(){var i,a,o,c,u;return m.default.wrap((function(s){for(;;)switch(s.prev=s.next){case 0:return s.next=3,n.runScript("register",n.prepareArray([e,t,r]));case 3:return c=s.sent,u=_(c,3),a=u[0],o=u[1],i=u[2],s.abrupt("return",{success:n.convertBool(a),wait:o,reservoir:i});case 9:case"end":return s.stop()}}),s)})))()}},{key:"__submit__",value:function(e,t){var r=this;return g(m.default.mark((function s(){var i,a,o,c,u,l,h,f,d;return m.default.wrap((function(s){for(;;)switch(s.prev=s.next){case 0:return s.prev=1,s.next=4,r.runScript("submit",r.prepareArray([e,t]));case 4:return l=s.sent,h=_(l,3),c=h[0],i=h[1],u=h[2],s.abrupt("return",{reachedHWM:r.convertBool(c),blocked:r.convertBool(i),strategy:u});case 12:if(s.prev=12,s.t0=s.catch(1),0!==(a=s.t0).message.indexOf("OVERWEIGHT")){s.next=24;break}throw f=a.message.split(":"),d=_(f,3),d[0],t=d[1],o=d[2],new n("Impossible to add a job having a weight of ".concat(t," to a limiter having a maxConcurrent setting of ").concat(o));case 24:throw a;case 25:case"end":return s.stop()}}),s,null,[[1,12]])})))()}},{key:"__free__",value:function(e,t){var r=this;return g(m.default.mark((function t(){var n;return m.default.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=3,r.runScript("free",r.prepareArray([e]));case 3:return n=t.sent,t.abrupt("return",{running:n});case 5:case"end":return t.stop()}}),t)})))()}}]),e}(),t.exports=a},{"@swc/helpers/src/_class_call_check.mjs":"bcDJH","@swc/helpers/src/_create_class.mjs":"e1EPh","@swc/helpers/src/_to_consumable_array.mjs":"lp3rF","regenerator-runtime":"achxx","./parser":"2BgUG","./BottleneckError":"bTksA","./RedisConnection":"btByZ","./IORedisConnection":"7LRob","@parcel/transformer-js/src/esmodule-helpers.js":"3ieD1"}],btByZ:[function(require,module,exports){var parcelHelpers=require("@parcel/transformer-js/src/esmodule-helpers.js"),_classCallCheckMjs=require("@swc/helpers/src/_class_call_check.mjs"),_classCallCheckMjsDefault=parcelHelpers.interopDefault(_classCallCheckMjs),_createClassMjs=require("@swc/helpers/src/_create_class.mjs"),_createClassMjsDefault=parcelHelpers.interopDefault(_createClassMjs),_regeneratorRuntime=require("regenerator-runtime"),_regeneratorRuntimeDefault=parcelHelpers.interopDefault(_regeneratorRuntime),Events,RedisConnection,Scripts,parser;function asyncGeneratorStep(e,t,r,n,s,i,a){try{var o=e[i](a),c=o.value}catch(e){return void r(e)}o.done?t(c):Promise.resolve(c).then(n,s)}function _asyncToGenerator(e){return function(){var t=this,r=arguments;return new Promise((function(n,s){var i=e.apply(t,r);function a(e){asyncGeneratorStep(i,n,s,a,o,"next",e)}function o(e){asyncGeneratorStep(i,n,s,a,o,"throw",e)}a(void 0)}))}}parser=require("./parser"),Events=require("./Events"),Scripts=require("./Scripts"),RedisConnection=function(){var RedisConnection=function(){function RedisConnection(){var options=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},_this=this;(0,_classCallCheckMjsDefault.default)(this,RedisConnection),parser.load(options,this.defaults,this),null==this.Redis&&(this.Redis=eval("require")("redis")),null==this.Events&&(this.Events=new Events(this)),this.terminated=!1,null==this.client&&(this.client=this.Redis.createClient(this.clientOptions)),this.subscriber=this.client.duplicate(),this.limiters={},this.shas={},this.ready=this.Promise.all([this._setup(this.client,!1),this._setup(this.subscriber,!0)]).then((function(){return _this._loadScripts()})).then((function(){return{client:_this.client,subscriber:_this.subscriber}}))}return(0,_createClassMjsDefault.default)(RedisConnection,[{key:"_setup",value:function(e,t){var r=this;return e.setMaxListeners(0),new this.Promise((function(n,s){return e.on("error",(function(e){return r.Events.trigger("error",e)})),t&&e.on("message",(function(e,t){var n;return null!=(n=r.limiters[e])?n._store.onMessage(e,t):void 0})),e.ready?n():e.once("ready",n)}))}},{key:"_loadScript",value:function(e){var t=this;return new this.Promise((function(r,n){var s;return s=Scripts.payload(e),t.client.multi([["script","load",s]]).exec((function(s,i){return null!=s?n(s):(t.shas[e]=i[0],r(i[0]))}))}))}},{key:"_loadScripts",value:function(){var e=this;return this.Promise.all(Scripts.names.map((function(t){return e._loadScript(t)})))}},{key:"__runCommand__",value:function(e){var t=this;return _asyncToGenerator(_regeneratorRuntimeDefault.default.mark((function r(){return _regeneratorRuntimeDefault.default.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return r.next=2,t.ready;case 2:return r.abrupt("return",new t.Promise((function(r,n){return t.client.multi([e]).exec_atomic((function(e,t){return null!=e?n(e):r(t[0])}))})));case 3:case"end":return r.stop()}}),r)})))()}},{key:"__addLimiter__",value:function(e){var t=this;return this.Promise.all([e.channel(),e.channel_client()].map((function(r){return new t.Promise((function(n,s){var i;return i=function(s){if(s===r)return t.subscriber.removeListener("subscribe",i),t.limiters[r]=e,n()},t.subscriber.on("subscribe",i),t.subscriber.subscribe(r)}))})))}},{key:"__removeLimiter__",value:function(e){var t=this;return this.Promise.all([e.channel(),e.channel_client()].map(function(){var e=_asyncToGenerator(_regeneratorRuntimeDefault.default.mark((function e(r){return _regeneratorRuntimeDefault.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t.terminated){e.next=3;break}return e.next=3,new t.Promise((function(e,n){return t.subscriber.unsubscribe(r,(function(t,s){return null!=t?n(t):s===r?e():void 0}))}));case 3:return e.abrupt("return",delete t.limiters[r]);case 4:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()))}},{key:"__scriptArgs__",value:function(e,t,r,n){var s;return s=Scripts.keys(e,t),[this.shas[e],s.length].concat(s,r,n)}},{key:"__scriptFn__",value:function(e){return this.client.evalsha.bind(this.client)}},{key:"disconnect",value:function(){var e,t,r,n,s=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];for(e=0,r=(n=Object.keys(this.limiters)).length;e<r;e++)t=n[e],clearInterval(this.limiters[t]._store.heartbeat);return this.limiters={},this.terminated=!0,this.client.end(s),this.subscriber.end(s),this.Promise.resolve()}}]),RedisConnection}();return RedisConnection.prototype.datastore="redis",RedisConnection.prototype.defaults={Redis:null,clientOptions:{},client:null,Promise:Promise,Events:null},RedisConnection}.call(void 0),module.exports=RedisConnection},{"@swc/helpers/src/_class_call_check.mjs":"bcDJH","@swc/helpers/src/_create_class.mjs":"e1EPh","regenerator-runtime":"achxx","./parser":"2BgUG","./Events":"atGPC","./Scripts":"9k6kW","@parcel/transformer-js/src/esmodule-helpers.js":"3ieD1"}],"9k6kW":[function(e,t,r){"use strict";var n,s,i;s=e("./lua.json"),n={refs:s["refs.lua"],validate_keys:s["validate_keys.lua"],validate_client:s["validate_client.lua"],refresh_expiration:s["refresh_expiration.lua"],process_tick:s["process_tick.lua"],conditions_check:s["conditions_check.lua"],get_time:s["get_time.lua"]},r.allKeys=function(e){return["b_".concat(e,"_settings"),"b_".concat(e,"_job_weights"),"b_".concat(e,"_job_expirations"),"b_".concat(e,"_job_clients"),"b_".concat(e,"_client_running"),"b_".concat(e,"_client_num_queued"),"b_".concat(e,"_client_last_registered"),"b_".concat(e,"_client_last_seen")]},i={init:{keys:r.allKeys,headers:["process_tick"],refresh_expiration:!0,code:s["init.lua"]},group_check:{keys:r.allKeys,headers:[],refresh_expiration:!1,code:s["group_check.lua"]},register_client:{keys:r.allKeys,headers:["validate_keys"],refresh_expiration:!1,code:s["register_client.lua"]},blacklist_client:{keys:r.allKeys,headers:["validate_keys","validate_client"],refresh_expiration:!1,code:s["blacklist_client.lua"]},heartbeat:{keys:r.allKeys,headers:["validate_keys","validate_client","process_tick"],refresh_expiration:!1,code:s["heartbeat.lua"]},update_settings:{keys:r.allKeys,headers:["validate_keys","validate_client","process_tick"],refresh_expiration:!0,code:s["update_settings.lua"]},running:{keys:r.allKeys,headers:["validate_keys","validate_client","process_tick"],refresh_expiration:!1,code:s["running.lua"]},queued:{keys:r.allKeys,headers:["validate_keys","validate_client"],refresh_expiration:!1,code:s["queued.lua"]},done:{keys:r.allKeys,headers:["validate_keys","validate_client","process_tick"],refresh_expiration:!1,code:s["done.lua"]},check:{keys:r.allKeys,headers:["validate_keys","validate_client","process_tick","conditions_check"],refresh_expiration:!1,code:s["check.lua"]},submit:{keys:r.allKeys,headers:["validate_keys","validate_client","process_tick","conditions_check"],refresh_expiration:!0,code:s["submit.lua"]},register:{keys:r.allKeys,headers:["validate_keys","validate_client","process_tick","conditions_check"],refresh_expiration:!0,code:s["register.lua"]},free:{keys:r.allKeys,headers:["validate_keys","validate_client","process_tick"],refresh_expiration:!0,code:s["free.lua"]},current_reservoir:{keys:r.allKeys,headers:["validate_keys","validate_client","process_tick"],refresh_expiration:!1,code:s["current_reservoir.lua"]},increment_reservoir:{keys:r.allKeys,headers:["validate_keys","validate_client","process_tick"],refresh_expiration:!0,code:s["increment_reservoir.lua"]}},r.names=Object.keys(i),r.keys=function(e,t){return i[e].keys(t)},r.payload=function(e){var t;return t=i[e],Array.prototype.concat(n.refs,t.headers.map((function(e){return n[e]})),t.refresh_expiration?n.refresh_expiration:"",t.code).join("\n")}},{"./lua.json":"eklbP"}],eklbP:[function(e,t,r){t.exports=JSON.parse("{\"blacklist_client.lua\":\"local blacklist = ARGV[num_static_argv + 1]\\n\\nif redis.call('zscore', client_last_seen_key, blacklist) then\\n  redis.call('zadd', client_last_seen_key, 0, blacklist)\\nend\\n\\n\\nreturn {}\\n\",\"check.lua\":\"local weight = tonumber(ARGV[num_static_argv + 1])\\n\\nlocal capacity = process_tick(now, false)['capacity']\\nlocal nextRequest = tonumber(redis.call('hget', settings_key, 'nextRequest'))\\n\\nreturn conditions_check(capacity, weight) and nextRequest - now <= 0\\n\",\"conditions_check.lua\":\"local conditions_check = function (capacity, weight)\\n  return capacity == nil or weight <= capacity\\nend\\n\",\"current_reservoir.lua\":\"return process_tick(now, false)['reservoir']\\n\",\"done.lua\":\"process_tick(now, false)\\n\\nreturn tonumber(redis.call('hget', settings_key, 'done'))\\n\",\"free.lua\":\"local index = ARGV[num_static_argv + 1]\\n\\nredis.call('zadd', job_expirations_key, 0, index)\\n\\nreturn process_tick(now, false)['running']\\n\",\"get_time.lua\":\"redis.replicate_commands()\\n\\nlocal get_time = function ()\\n  local time = redis.call('time')\\n\\n  return tonumber(time[1]..string.sub(time[2], 1, 3))\\nend\\n\",\"group_check.lua\":\"return not (redis.call('exists', settings_key) == 1)\\n\",\"heartbeat.lua\":\"process_tick(now, true)\\n\",\"increment_reservoir.lua\":\"local incr = tonumber(ARGV[num_static_argv + 1])\\n\\nredis.call('hincrby', settings_key, 'reservoir', incr)\\n\\nlocal reservoir = process_tick(now, true)['reservoir']\\n\\nlocal groupTimeout = tonumber(redis.call('hget', settings_key, 'groupTimeout'))\\nrefresh_expiration(0, 0, groupTimeout)\\n\\nreturn reservoir\\n\",\"init.lua\":\"local clear = tonumber(ARGV[num_static_argv + 1])\\nlocal limiter_version = ARGV[num_static_argv + 2]\\nlocal num_local_argv = num_static_argv + 2\\n\\nif clear == 1 then\\n  redis.call('del', unpack(KEYS))\\nend\\n\\nif redis.call('exists', settings_key) == 0 then\\n  -- Create\\n  local args = {'hmset', settings_key}\\n\\n  for i = num_local_argv + 1, #ARGV do\\n    table.insert(args, ARGV[i])\\n  end\\n\\n  redis.call(unpack(args))\\n  redis.call('hmset', settings_key,\\n    'nextRequest', now,\\n    'lastReservoirRefresh', now,\\n    'lastReservoirIncrease', now,\\n    'running', 0,\\n    'done', 0,\\n    'unblockTime', 0,\\n    'capacityPriorityCounter', 0\\n  )\\n\\nelse\\n  -- Apply migrations\\n  local settings = redis.call('hmget', settings_key,\\n    'id',\\n    'version'\\n  )\\n  local id = settings[1]\\n  local current_version = settings[2]\\n\\n  if current_version ~= limiter_version then\\n    local version_digits = {}\\n    for k, v in string.gmatch(current_version, \\\"([^.]+)\\\") do\\n      table.insert(version_digits, tonumber(k))\\n    end\\n\\n    -- 2.10.0\\n    if version_digits[2] < 10 then\\n      redis.call('hsetnx', settings_key, 'reservoirRefreshInterval', '')\\n      redis.call('hsetnx', settings_key, 'reservoirRefreshAmount', '')\\n      redis.call('hsetnx', settings_key, 'lastReservoirRefresh', '')\\n      redis.call('hsetnx', settings_key, 'done', 0)\\n      redis.call('hset', settings_key, 'version', '2.10.0')\\n    end\\n\\n    -- 2.11.1\\n    if version_digits[2] < 11 or (version_digits[2] == 11 and version_digits[3] < 1) then\\n      if redis.call('hstrlen', settings_key, 'lastReservoirRefresh') == 0 then\\n        redis.call('hmset', settings_key,\\n          'lastReservoirRefresh', now,\\n          'version', '2.11.1'\\n        )\\n      end\\n    end\\n\\n    -- 2.14.0\\n    if version_digits[2] < 14 then\\n      local old_running_key = 'b_'..id..'_running'\\n      local old_executing_key = 'b_'..id..'_executing'\\n\\n      if redis.call('exists', old_running_key) == 1 then\\n        redis.call('rename', old_running_key, job_weights_key)\\n      end\\n      if redis.call('exists', old_executing_key) == 1 then\\n        redis.call('rename', old_executing_key, job_expirations_key)\\n      end\\n      redis.call('hset', settings_key, 'version', '2.14.0')\\n    end\\n\\n    -- 2.15.2\\n    if version_digits[2] < 15 or (version_digits[2] == 15 and version_digits[3] < 2) then\\n      redis.call('hsetnx', settings_key, 'capacityPriorityCounter', 0)\\n      redis.call('hset', settings_key, 'version', '2.15.2')\\n    end\\n\\n    -- 2.17.0\\n    if version_digits[2] < 17 then\\n      redis.call('hsetnx', settings_key, 'clientTimeout', 10000)\\n      redis.call('hset', settings_key, 'version', '2.17.0')\\n    end\\n\\n    -- 2.18.0\\n    if version_digits[2] < 18 then\\n      redis.call('hsetnx', settings_key, 'reservoirIncreaseInterval', '')\\n      redis.call('hsetnx', settings_key, 'reservoirIncreaseAmount', '')\\n      redis.call('hsetnx', settings_key, 'reservoirIncreaseMaximum', '')\\n      redis.call('hsetnx', settings_key, 'lastReservoirIncrease', now)\\n      redis.call('hset', settings_key, 'version', '2.18.0')\\n    end\\n\\n  end\\n\\n  process_tick(now, false)\\nend\\n\\nlocal groupTimeout = tonumber(redis.call('hget', settings_key, 'groupTimeout'))\\nrefresh_expiration(0, 0, groupTimeout)\\n\\nreturn {}\\n\",\"process_tick.lua\":\"local process_tick = function (now, always_publish)\\n\\n  local compute_capacity = function (maxConcurrent, running, reservoir)\\n    if maxConcurrent ~= nil and reservoir ~= nil then\\n      return math.min((maxConcurrent - running), reservoir)\\n    elseif maxConcurrent ~= nil then\\n      return maxConcurrent - running\\n    elseif reservoir ~= nil then\\n      return reservoir\\n    else\\n      return nil\\n    end\\n  end\\n\\n  local settings = redis.call('hmget', settings_key,\\n    'id',\\n    'maxConcurrent',\\n    'running',\\n    'reservoir',\\n    'reservoirRefreshInterval',\\n    'reservoirRefreshAmount',\\n    'lastReservoirRefresh',\\n    'reservoirIncreaseInterval',\\n    'reservoirIncreaseAmount',\\n    'reservoirIncreaseMaximum',\\n    'lastReservoirIncrease',\\n    'capacityPriorityCounter',\\n    'clientTimeout'\\n  )\\n  local id = settings[1]\\n  local maxConcurrent = tonumber(settings[2])\\n  local running = tonumber(settings[3])\\n  local reservoir = tonumber(settings[4])\\n  local reservoirRefreshInterval = tonumber(settings[5])\\n  local reservoirRefreshAmount = tonumber(settings[6])\\n  local lastReservoirRefresh = tonumber(settings[7])\\n  local reservoirIncreaseInterval = tonumber(settings[8])\\n  local reservoirIncreaseAmount = tonumber(settings[9])\\n  local reservoirIncreaseMaximum = tonumber(settings[10])\\n  local lastReservoirIncrease = tonumber(settings[11])\\n  local capacityPriorityCounter = tonumber(settings[12])\\n  local clientTimeout = tonumber(settings[13])\\n\\n  local initial_capacity = compute_capacity(maxConcurrent, running, reservoir)\\n\\n  --\\n  -- Process 'running' changes\\n  --\\n  local expired = redis.call('zrangebyscore', job_expirations_key, '-inf', '('..now)\\n\\n  if #expired > 0 then\\n    redis.call('zremrangebyscore', job_expirations_key, '-inf', '('..now)\\n\\n    local flush_batch = function (batch, acc)\\n      local weights = redis.call('hmget', job_weights_key, unpack(batch))\\n                      redis.call('hdel',  job_weights_key, unpack(batch))\\n      local clients = redis.call('hmget', job_clients_key, unpack(batch))\\n                      redis.call('hdel',  job_clients_key, unpack(batch))\\n\\n      -- Calculate sum of removed weights\\n      for i = 1, #weights do\\n        acc['total'] = acc['total'] + (tonumber(weights[i]) or 0)\\n      end\\n\\n      -- Calculate sum of removed weights by client\\n      local client_weights = {}\\n      for i = 1, #clients do\\n        local removed = tonumber(weights[i]) or 0\\n        if removed > 0 then\\n          acc['client_weights'][clients[i]] = (acc['client_weights'][clients[i]] or 0) + removed\\n        end\\n      end\\n    end\\n\\n    local acc = {\\n      ['total'] = 0,\\n      ['client_weights'] = {}\\n    }\\n    local batch_size = 1000\\n\\n    -- Compute changes to Zsets and apply changes to Hashes\\n    for i = 1, #expired, batch_size do\\n      local batch = {}\\n      for j = i, math.min(i + batch_size - 1, #expired) do\\n        table.insert(batch, expired[j])\\n      end\\n\\n      flush_batch(batch, acc)\\n    end\\n\\n    -- Apply changes to Zsets\\n    if acc['total'] > 0 then\\n      redis.call('hincrby', settings_key, 'done', acc['total'])\\n      running = tonumber(redis.call('hincrby', settings_key, 'running', -acc['total']))\\n    end\\n\\n    for client, weight in pairs(acc['client_weights']) do\\n      redis.call('zincrby', client_running_key, -weight, client)\\n    end\\n  end\\n\\n  --\\n  -- Process 'reservoir' changes\\n  --\\n  local reservoirRefreshActive = reservoirRefreshInterval ~= nil and reservoirRefreshAmount ~= nil\\n  if reservoirRefreshActive and now >= lastReservoirRefresh + reservoirRefreshInterval then\\n    reservoir = reservoirRefreshAmount\\n    redis.call('hmset', settings_key,\\n      'reservoir', reservoir,\\n      'lastReservoirRefresh', now\\n    )\\n  end\\n\\n  local reservoirIncreaseActive = reservoirIncreaseInterval ~= nil and reservoirIncreaseAmount ~= nil\\n  if reservoirIncreaseActive and now >= lastReservoirIncrease + reservoirIncreaseInterval then\\n    local num_intervals = math.floor((now - lastReservoirIncrease) / reservoirIncreaseInterval)\\n    local incr = reservoirIncreaseAmount * num_intervals\\n    if reservoirIncreaseMaximum ~= nil then\\n      incr = math.min(incr, reservoirIncreaseMaximum - (reservoir or 0))\\n    end\\n    if incr > 0 then\\n      reservoir = (reservoir or 0) + incr\\n    end\\n    redis.call('hmset', settings_key,\\n      'reservoir', reservoir,\\n      'lastReservoirIncrease', lastReservoirIncrease + (num_intervals * reservoirIncreaseInterval)\\n    )\\n  end\\n\\n  --\\n  -- Clear unresponsive clients\\n  --\\n  local unresponsive = redis.call('zrangebyscore', client_last_seen_key, '-inf', (now - clientTimeout))\\n  local unresponsive_lookup = {}\\n  local terminated_clients = {}\\n  for i = 1, #unresponsive do\\n    unresponsive_lookup[unresponsive[i]] = true\\n    if tonumber(redis.call('zscore', client_running_key, unresponsive[i])) == 0 then\\n      table.insert(terminated_clients, unresponsive[i])\\n    end\\n  end\\n  if #terminated_clients > 0 then\\n    redis.call('zrem', client_running_key,         unpack(terminated_clients))\\n    redis.call('hdel', client_num_queued_key,      unpack(terminated_clients))\\n    redis.call('zrem', client_last_registered_key, unpack(terminated_clients))\\n    redis.call('zrem', client_last_seen_key,       unpack(terminated_clients))\\n  end\\n\\n  --\\n  -- Broadcast capacity changes\\n  --\\n  local final_capacity = compute_capacity(maxConcurrent, running, reservoir)\\n\\n  if always_publish or (initial_capacity ~= nil and final_capacity == nil) then\\n    -- always_publish or was not unlimited, now unlimited\\n    redis.call('publish', 'b_'..id, 'capacity:'..(final_capacity or ''))\\n\\n  elseif initial_capacity ~= nil and final_capacity ~= nil and final_capacity > initial_capacity then\\n    -- capacity was increased\\n    -- send the capacity message to the limiter having the lowest number of running jobs\\n    -- the tiebreaker is the limiter having not registered a job in the longest time\\n\\n    local lowest_concurrency_value = nil\\n    local lowest_concurrency_clients = {}\\n    local lowest_concurrency_last_registered = {}\\n    local client_concurrencies = redis.call('zrange', client_running_key, 0, -1, 'withscores')\\n\\n    for i = 1, #client_concurrencies, 2 do\\n      local client = client_concurrencies[i]\\n      local concurrency = tonumber(client_concurrencies[i+1])\\n\\n      if (\\n        lowest_concurrency_value == nil or lowest_concurrency_value == concurrency\\n      ) and (\\n        not unresponsive_lookup[client]\\n      ) and (\\n        tonumber(redis.call('hget', client_num_queued_key, client)) > 0\\n      ) then\\n        lowest_concurrency_value = concurrency\\n        table.insert(lowest_concurrency_clients, client)\\n        local last_registered = tonumber(redis.call('zscore', client_last_registered_key, client))\\n        table.insert(lowest_concurrency_last_registered, last_registered)\\n      end\\n    end\\n\\n    if #lowest_concurrency_clients > 0 then\\n      local position = 1\\n      local earliest = lowest_concurrency_last_registered[1]\\n\\n      for i,v in ipairs(lowest_concurrency_last_registered) do\\n        if v < earliest then\\n          position = i\\n          earliest = v\\n        end\\n      end\\n\\n      local next_client = lowest_concurrency_clients[position]\\n      redis.call('publish', 'b_'..id,\\n        'capacity-priority:'..(final_capacity or '')..\\n        ':'..next_client..\\n        ':'..capacityPriorityCounter\\n      )\\n      redis.call('hincrby', settings_key, 'capacityPriorityCounter', '1')\\n    else\\n      redis.call('publish', 'b_'..id, 'capacity:'..(final_capacity or ''))\\n    end\\n  end\\n\\n  return {\\n    ['capacity'] = final_capacity,\\n    ['running'] = running,\\n    ['reservoir'] = reservoir\\n  }\\nend\\n\",\"queued.lua\":\"local clientTimeout = tonumber(redis.call('hget', settings_key, 'clientTimeout'))\\nlocal valid_clients = redis.call('zrangebyscore', client_last_seen_key, (now - clientTimeout), 'inf')\\nlocal client_queued = redis.call('hmget', client_num_queued_key, unpack(valid_clients))\\n\\nlocal sum = 0\\nfor i = 1, #client_queued do\\n  sum = sum + tonumber(client_queued[i])\\nend\\n\\nreturn sum\\n\",\"refresh_expiration.lua\":\"local refresh_expiration = function (now, nextRequest, groupTimeout)\\n\\n  if groupTimeout ~= nil then\\n    local ttl = (nextRequest + groupTimeout) - now\\n\\n    for i = 1, #KEYS do\\n      redis.call('pexpire', KEYS[i], ttl)\\n    end\\n  end\\n\\nend\\n\",\"refs.lua\":\"local settings_key = KEYS[1]\\nlocal job_weights_key = KEYS[2]\\nlocal job_expirations_key = KEYS[3]\\nlocal job_clients_key = KEYS[4]\\nlocal client_running_key = KEYS[5]\\nlocal client_num_queued_key = KEYS[6]\\nlocal client_last_registered_key = KEYS[7]\\nlocal client_last_seen_key = KEYS[8]\\n\\nlocal now = tonumber(ARGV[1])\\nlocal client = ARGV[2]\\n\\nlocal num_static_argv = 2\\n\",\"register.lua\":\"local index = ARGV[num_static_argv + 1]\\nlocal weight = tonumber(ARGV[num_static_argv + 2])\\nlocal expiration = tonumber(ARGV[num_static_argv + 3])\\n\\nlocal state = process_tick(now, false)\\nlocal capacity = state['capacity']\\nlocal reservoir = state['reservoir']\\n\\nlocal settings = redis.call('hmget', settings_key,\\n  'nextRequest',\\n  'minTime',\\n  'groupTimeout'\\n)\\nlocal nextRequest = tonumber(settings[1])\\nlocal minTime = tonumber(settings[2])\\nlocal groupTimeout = tonumber(settings[3])\\n\\nif conditions_check(capacity, weight) then\\n\\n  redis.call('hincrby', settings_key, 'running', weight)\\n  redis.call('hset', job_weights_key, index, weight)\\n  if expiration ~= nil then\\n    redis.call('zadd', job_expirations_key, now + expiration, index)\\n  end\\n  redis.call('hset', job_clients_key, index, client)\\n  redis.call('zincrby', client_running_key, weight, client)\\n  redis.call('hincrby', client_num_queued_key, client, -1)\\n  redis.call('zadd', client_last_registered_key, now, client)\\n\\n  local wait = math.max(nextRequest - now, 0)\\n  local newNextRequest = now + wait + minTime\\n\\n  if reservoir == nil then\\n    redis.call('hset', settings_key,\\n      'nextRequest', newNextRequest\\n    )\\n  else\\n    reservoir = reservoir - weight\\n    redis.call('hmset', settings_key,\\n      'reservoir', reservoir,\\n      'nextRequest', newNextRequest\\n    )\\n  end\\n\\n  refresh_expiration(now, newNextRequest, groupTimeout)\\n\\n  return {true, wait, reservoir}\\n\\nelse\\n  return {false}\\nend\\n\",\"register_client.lua\":\"local queued = tonumber(ARGV[num_static_argv + 1])\\n\\n-- Could have been re-registered concurrently\\nif not redis.call('zscore', client_last_seen_key, client) then\\n  redis.call('zadd', client_running_key, 0, client)\\n  redis.call('hset', client_num_queued_key, client, queued)\\n  redis.call('zadd', client_last_registered_key, 0, client)\\nend\\n\\nredis.call('zadd', client_last_seen_key, now, client)\\n\\nreturn {}\\n\",\"running.lua\":\"return process_tick(now, false)['running']\\n\",\"submit.lua\":\"local queueLength = tonumber(ARGV[num_static_argv + 1])\\nlocal weight = tonumber(ARGV[num_static_argv + 2])\\n\\nlocal capacity = process_tick(now, false)['capacity']\\n\\nlocal settings = redis.call('hmget', settings_key,\\n  'id',\\n  'maxConcurrent',\\n  'highWater',\\n  'nextRequest',\\n  'strategy',\\n  'unblockTime',\\n  'penalty',\\n  'minTime',\\n  'groupTimeout'\\n)\\nlocal id = settings[1]\\nlocal maxConcurrent = tonumber(settings[2])\\nlocal highWater = tonumber(settings[3])\\nlocal nextRequest = tonumber(settings[4])\\nlocal strategy = tonumber(settings[5])\\nlocal unblockTime = tonumber(settings[6])\\nlocal penalty = tonumber(settings[7])\\nlocal minTime = tonumber(settings[8])\\nlocal groupTimeout = tonumber(settings[9])\\n\\nif maxConcurrent ~= nil and weight > maxConcurrent then\\n  return redis.error_reply('OVERWEIGHT:'..weight..':'..maxConcurrent)\\nend\\n\\nlocal reachedHWM = (highWater ~= nil and queueLength == highWater\\n  and not (\\n    conditions_check(capacity, weight)\\n    and nextRequest - now <= 0\\n  )\\n)\\n\\nlocal blocked = strategy == 3 and (reachedHWM or unblockTime >= now)\\n\\nif blocked then\\n  local computedPenalty = penalty\\n  if computedPenalty == nil then\\n    if minTime == 0 then\\n      computedPenalty = 5000\\n    else\\n      computedPenalty = 15 * minTime\\n    end\\n  end\\n\\n  local newNextRequest = now + computedPenalty + minTime\\n\\n  redis.call('hmset', settings_key,\\n    'unblockTime', now + computedPenalty,\\n    'nextRequest', newNextRequest\\n  )\\n\\n  local clients_queued_reset = redis.call('hkeys', client_num_queued_key)\\n  local queued_reset = {}\\n  for i = 1, #clients_queued_reset do\\n    table.insert(queued_reset, clients_queued_reset[i])\\n    table.insert(queued_reset, 0)\\n  end\\n  redis.call('hmset', client_num_queued_key, unpack(queued_reset))\\n\\n  redis.call('publish', 'b_'..id, 'blocked:')\\n\\n  refresh_expiration(now, newNextRequest, groupTimeout)\\nend\\n\\nif not blocked and not reachedHWM then\\n  redis.call('hincrby', client_num_queued_key, client, 1)\\nend\\n\\nreturn {reachedHWM, blocked, strategy}\\n\",\"update_settings.lua\":\"local args = {'hmset', settings_key}\\n\\nfor i = num_static_argv + 1, #ARGV do\\n  table.insert(args, ARGV[i])\\nend\\n\\nredis.call(unpack(args))\\n\\nprocess_tick(now, true)\\n\\nlocal groupTimeout = tonumber(redis.call('hget', settings_key, 'groupTimeout'))\\nrefresh_expiration(0, 0, groupTimeout)\\n\\nreturn {}\\n\",\"validate_client.lua\":\"if not redis.call('zscore', client_last_seen_key, client) then\\n  return redis.error_reply('UNKNOWN_CLIENT')\\nend\\n\\nredis.call('zadd', client_last_seen_key, now, client)\\n\",\"validate_keys.lua\":\"if not (redis.call('exists', settings_key) == 1) then\\n  return redis.error_reply('SETTINGS_KEY_NOT_FOUND')\\nend\\n\"}")},{}],"7LRob":[function(require,module,exports){var parcelHelpers=require("@parcel/transformer-js/src/esmodule-helpers.js"),_classCallCheckMjs=require("@swc/helpers/src/_class_call_check.mjs"),_classCallCheckMjsDefault=parcelHelpers.interopDefault(_classCallCheckMjs),_createClassMjs=require("@swc/helpers/src/_create_class.mjs"),_createClassMjsDefault=parcelHelpers.interopDefault(_createClassMjs),_regeneratorRuntime=require("regenerator-runtime"),_regeneratorRuntimeDefault=parcelHelpers.interopDefault(_regeneratorRuntime),Events,IORedisConnection,Scripts,parser;function _slicedToArray(e,t){return _arrayWithHoles(e)||_iterableToArrayLimit(e,t)||_nonIterableRest()}function _nonIterableRest(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}function _iterableToArrayLimit(e,t){var r=[],n=!0,s=!1,i=void 0;try{for(var a,o=e[Symbol.iterator]();!(n=(a=o.next()).done)&&(r.push(a.value),!t||r.length!==t);n=!0);}catch(e){s=!0,i=e}finally{try{n||null==o.return||o.return()}finally{if(s)throw i}}return r}function _arrayWithHoles(e){if(Array.isArray(e))return e}function asyncGeneratorStep(e,t,r,n,s,i,a){try{var o=e[i](a),c=o.value}catch(e){return void r(e)}o.done?t(c):Promise.resolve(c).then(n,s)}function _asyncToGenerator(e){return function(){var t=this,r=arguments;return new Promise((function(n,s){var i=e.apply(t,r);function a(e){asyncGeneratorStep(i,n,s,a,o,"next",e)}function o(e){asyncGeneratorStep(i,n,s,a,o,"throw",e)}a(void 0)}))}}parser=require("./parser"),Events=require("./Events"),Scripts=require("./Scripts"),IORedisConnection=function(){var IORedisConnection=function(){function IORedisConnection(){var options=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},_this=this;(0,_classCallCheckMjsDefault.default)(this,IORedisConnection),parser.load(options,this.defaults,this),null==this.Redis&&(this.Redis=eval("require")("ioredis")),null==this.Events&&(this.Events=new Events(this)),this.terminated=!1,null!=this.clusterNodes?(this.client=new this.Redis.Cluster(this.clusterNodes,this.clientOptions),this.subscriber=new this.Redis.Cluster(this.clusterNodes,this.clientOptions)):null!=this.client&&null==this.client.duplicate?this.subscriber=new this.Redis.Cluster(this.client.startupNodes,this.client.options):(null==this.client&&(this.client=new this.Redis(this.clientOptions)),this.subscriber=this.client.duplicate()),this.limiters={},this.ready=this.Promise.all([this._setup(this.client,!1),this._setup(this.subscriber,!0)]).then((function(){return _this._loadScripts(),{client:_this.client,subscriber:_this.subscriber}}))}return(0,_createClassMjsDefault.default)(IORedisConnection,[{key:"_setup",value:function(e,t){var r=this;return e.setMaxListeners(0),new this.Promise((function(n,s){return e.on("error",(function(e){return r.Events.trigger("error",e)})),t&&e.on("message",(function(e,t){var n;return null!=(n=r.limiters[e])?n._store.onMessage(e,t):void 0})),"ready"===e.status?n():e.once("ready",n)}))}},{key:"_loadScripts",value:function(){var e=this;return Scripts.names.forEach((function(t){return e.client.defineCommand(t,{lua:Scripts.payload(t)})}))}},{key:"__runCommand__",value:function(e){var t=this;return _asyncToGenerator(_regeneratorRuntimeDefault.default.mark((function r(){var n,s,i,a;return _regeneratorRuntimeDefault.default.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return r.next=3,t.ready;case 3:return r.next=5,t.client.pipeline([e]).exec();case 5:return s=r.sent,i=_slicedToArray(s,1),a=_slicedToArray(i[0],2),a[0],n=a[1],r.abrupt("return",n);case 11:case"end":return r.stop()}}),r)})))()}},{key:"__addLimiter__",value:function(e){var t=this;return this.Promise.all([e.channel(),e.channel_client()].map((function(r){return new t.Promise((function(n,s){return t.subscriber.subscribe(r,(function(){return t.limiters[r]=e,n()}))}))})))}},{key:"__removeLimiter__",value:function(e){var t=this;return[e.channel(),e.channel_client()].forEach(function(){var e=_asyncToGenerator(_regeneratorRuntimeDefault.default.mark((function e(r){return _regeneratorRuntimeDefault.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t.terminated){e.next=3;break}return e.next=3,t.subscriber.unsubscribe(r);case 3:return e.abrupt("return",delete t.limiters[r]);case 4:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}())}},{key:"__scriptArgs__",value:function(e,t,r,n){var s;return[(s=Scripts.keys(e,t)).length].concat(s,r,n)}},{key:"__scriptFn__",value:function(e){return this.client[e].bind(this.client)}},{key:"disconnect",value:function(){var e,t,r,n,s=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];for(e=0,r=(n=Object.keys(this.limiters)).length;e<r;e++)t=n[e],clearInterval(this.limiters[t]._store.heartbeat);return this.limiters={},this.terminated=!0,s?this.Promise.all([this.client.quit(),this.subscriber.quit()]):(this.client.disconnect(),this.subscriber.disconnect(),this.Promise.resolve())}}]),IORedisConnection}();return IORedisConnection.prototype.datastore="ioredis",IORedisConnection.prototype.defaults={Redis:null,clientOptions:{},clusterNodes:null,client:null,Promise:Promise,Events:null},IORedisConnection}.call(void 0),module.exports=IORedisConnection},{"@swc/helpers/src/_class_call_check.mjs":"bcDJH","@swc/helpers/src/_create_class.mjs":"e1EPh","regenerator-runtime":"achxx","./parser":"2BgUG","./Events":"atGPC","./Scripts":"9k6kW","@parcel/transformer-js/src/esmodule-helpers.js":"3ieD1"}],vqi7z:[function(e,t,r){var n,s,i=e("@parcel/transformer-js/src/esmodule-helpers.js"),a=e("@swc/helpers/src/_class_call_check.mjs"),o=i.interopDefault(a),c=e("@swc/helpers/src/_create_class.mjs"),u=i.interopDefault(c);n=e("./BottleneckError"),s=function(){function e(t){(0,o.default)(this,e),this.status=t,this._jobs={},this.counts=this.status.map((function(){return 0}))}return(0,u.default)(e,[{key:"next",value:function(e){var t,r;return r=(t=this._jobs[e])+1,null!=t&&r<this.status.length?(this.counts[t]--,this.counts[r]++,this._jobs[e]++):null!=t?(this.counts[t]--,delete this._jobs[e]):void 0}},{key:"start",value:function(e){return 0,this._jobs[e]=0,this.counts[0]++}},{key:"remove",value:function(e){var t;return null!=(t=this._jobs[e])&&(this.counts[t]--,delete this._jobs[e]),null!=t}},{key:"jobStatus",value:function(e){var t;return null!=(t=this.status[this._jobs[e]])?t:null}},{key:"statusJobs",value:function(e){var t,r,s,i;if(null!=e){if((r=this.status.indexOf(e))<0)throw new n("status must be one of ".concat(this.status.join(", ")));for(t in i=[],s=this._jobs)s[t]===r&&i.push(t);return i}return Object.keys(this._jobs)}},{key:"statusCounts",value:function(){var e=this;return this.counts.reduce((function(t,r,n){return t[e.status[n]]=r,t}),{})}}]),e}(),t.exports=s},{"@swc/helpers/src/_class_call_check.mjs":"bcDJH","@swc/helpers/src/_create_class.mjs":"e1EPh","./BottleneckError":"bTksA","@parcel/transformer-js/src/esmodule-helpers.js":"3ieD1"}],jNoa1:[function(e,t,r){var n,s,i=e("@parcel/transformer-js/src/esmodule-helpers.js"),a=e("@swc/helpers/src/_class_call_check.mjs"),o=i.interopDefault(a),c=e("@swc/helpers/src/_create_class.mjs"),u=i.interopDefault(c),l=e("@swc/helpers/src/_to_consumable_array.mjs"),h=i.interopDefault(l),f=e("regenerator-runtime"),d=i.interopDefault(f);function p(e,t,r,n,s,i,a){try{var o=e[i](a),c=o.value}catch(e){return void r(e)}o.done?t(c):Promise.resolve(c).then(n,s)}function v(e){return function(){var t=this,r=arguments;return new Promise((function(n,s){var i=e.apply(t,r);function a(e){p(i,n,s,a,o,"next",e)}function o(e){p(i,n,s,a,o,"throw",e)}a(void 0)}))}}n=e("./DLList"),s=function(){function e(t,r){(0,o.default)(this,e),this.schedule=this.schedule.bind(this),this.name=t,this.Promise=r,this._running=0,this._queue=new n}return(0,u.default)(e,[{key:"isEmpty",value:function(){return 0===this._queue.length}},{key:"_tryToRun",value:function(){var e=this;return v(d.default.mark((function t(){var r,n,s,i,a,o,c,u;return d.default.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!(e._running<1&&e._queue.length>0)){t.next=14;break}return e._running++,u=e._queue.shift(),c=u.task,r=u.args,a=u.resolve,i=u.reject,t.next=10,v(d.default.mark((function e(){return d.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,c.apply(void 0,(0,h.default)(r));case 3:return o=e.sent,e.abrupt("return",(function(){return a(o)}));case 7:return e.prev=7,e.t0=e.catch(0),s=e.t0,e.abrupt("return",(function(){return i(s)}));case 11:case"end":return e.stop()}}),e,null,[[0,7]])})))();case 10:return n=t.sent,e._running--,e._tryToRun(),t.abrupt("return",n());case 14:case"end":return t.stop()}}),t)})))()}},{key:"schedule",value:function(e){for(var t=arguments.length,r=new Array(t>1?t-1:0),n=1;n<t;n++)r[n-1]=arguments[n];var s,i,a;return a=i=null,s=new this.Promise((function(e,t){return a=e,i=t})),this._queue.push({task:e,args:r,resolve:a,reject:i}),this._tryToRun(),s}}]),e}(),t.exports=s},{"@swc/helpers/src/_class_call_check.mjs":"bcDJH","@swc/helpers/src/_create_class.mjs":"e1EPh","@swc/helpers/src/_to_consumable_array.mjs":"lp3rF","regenerator-runtime":"achxx","./DLList":"inXX9","@parcel/transformer-js/src/esmodule-helpers.js":"3ieD1"}],"2ioVv":[function(e,t,r){t.exports=JSON.parse('{"version":"2.19.5"}')},{}],atrI1:[function(e,t,r){var n,s,i,a,o,c,u=e("@parcel/transformer-js/src/esmodule-helpers.js"),l=e("@swc/helpers/src/_class_call_check.mjs"),h=u.interopDefault(l),f=e("@swc/helpers/src/_create_class.mjs"),d=u.interopDefault(f),p=e("@swc/helpers/src/_to_consumable_array.mjs"),v=u.interopDefault(p),m=e("regenerator-runtime"),_=u.interopDefault(m);function y(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var r=[],n=!0,s=!1,i=void 0;try{for(var a,o=e[Symbol.iterator]();!(n=(a=o.next()).done)&&(r.push(a.value),!t||r.length!==t);n=!0);}catch(e){s=!0,i=e}finally{try{n||null==o.return||o.return()}finally{if(s)throw i}}return r}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}()}function g(e,t,r,n,s,i,a){try{var o=e[i](a),c=o.value}catch(e){return void r(e)}o.done?t(c):Promise.resolve(c).then(n,s)}function k(e){return function(){var t=this,r=arguments;return new Promise((function(n,s){var i=e.apply(t,r);function a(e){g(i,n,s,a,o,"next",e)}function o(e){g(i,n,s,a,o,"throw",e)}a(void 0)}))}}c=e("./parser"),n=e("./Events"),a=e("./RedisConnection"),i=e("./IORedisConnection"),o=e("./Scripts"),s=function(){var t=function(){function t(){var r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};(0,h.default)(this,t),this.deleteKey=this.deleteKey.bind(this),this.limiterOptions=r,c.load(this.limiterOptions,this.defaults,this),this.Events=new n(this),this.instances={},this.Bottleneck=e("./Bottleneck"),this._startAutoCleanup(),this.sharedConnection=null!=this.connection,null==this.connection&&("redis"===this.limiterOptions.datastore?this.connection=new a(Object.assign({},this.limiterOptions,{Events:this.Events})):"ioredis"===this.limiterOptions.datastore&&(this.connection=new i(Object.assign({},this.limiterOptions,{Events:this.Events}))))}return(0,d.default)(t,[{key:"key",value:function(){var e,t,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",n=this;return null!=(e=this.instances[r])?e:(t=n.instances[r]=new n.Bottleneck(Object.assign(n.limiterOptions,{id:"".concat(n.id,"-").concat(r),timeout:n.timeout,connection:n.connection})),n.Events.trigger("created",t,r),t)}},{key:"deleteKey",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",t=this;return k(_.default.mark((function r(){var n,s;return _.default.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:if(s=t.instances[e],!t.connection){r.next=6;break}return r.next=5,t.connection.__runCommand__(["del"].concat((0,v.default)(o.allKeys("".concat(t.id,"-").concat(e)))));case 5:n=r.sent;case 6:if(null==s){r.next=10;break}return delete t.instances[e],r.next=10,s.disconnect();case 10:return r.abrupt("return",null!=s||n>0);case 11:case"end":return r.stop()}}),r)})))()}},{key:"limiters",value:function(){var e,t,r,n;for(e in r=[],t=this.instances)n=t[e],r.push({key:e,limiter:n});return r}},{key:"keys",value:function(){return Object.keys(this.instances)}},{key:"clusterKeys",value:function(){var e=this;return k(_.default.mark((function t(){var r,n,s,i,a,o,c,u,l,h,f;return _.default.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(null!=e.connection){t.next=3;break}return t.abrupt("return",e.Promise.resolve(e.keys()));case 3:o=[],r=null,l="b_".concat(e.id,"-").length,n=9;case 7:if(0===r){t.next=18;break}return t.next=10,e.connection.__runCommand__(["scan",null!=r?r:0,"match","b_".concat(e.id,"-*_settings"),"count",1e4]);case 10:for(h=t.sent,f=y(h,2),u=f[0],s=f[1],r=~~u,i=0,c=s.length;i<c;i++)a=s[i],o.push(a.slice(l,-n));t.next=7;break;case 18:return t.abrupt("return",o);case 19:case"end":return t.stop()}}),t)})))()}},{key:"_startAutoCleanup",value:function(){var e,t=this;return clearInterval(this.interval),"function"==typeof(e=this.interval=setInterval(k(_.default.mark((function e(){var r,n,s,i,a,o;return _.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:a=Date.now(),s=t.instances,i=[],e.t0=regeneratorRuntime.keys(s);case 5:if((e.t1=e.t0()).done){e.next=24;break}return n=e.t1.value,o=s[n],e.prev=8,e.next=11,o._store.__groupCheck__(a);case 11:if(!e.sent){e.next=15;break}i.push(t.deleteKey(n)),e.next=16;break;case 15:i.push(void 0);case 16:e.next=22;break;case 18:e.prev=18,e.t2=e.catch(8),r=e.t2,i.push(o.Events.trigger("error",r));case 22:e.next=5;break;case 24:return e.abrupt("return",i);case 25:case"end":return e.stop()}}),e,null,[[8,18]])}))),this.timeout/2)).unref?e.unref():void 0}},{key:"updateSettings",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};if(c.overwrite(e,this.defaults,this),c.overwrite(e,e,this.limiterOptions),null!=e.timeout)return this._startAutoCleanup()}},{key:"disconnect",value:function(){var e,t=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];if(!this.sharedConnection)return null!=(e=this.connection)?e.disconnect(t):void 0}}]),t}();return t.prototype.defaults={timeout:3e5,connection:null,Promise:Promise,id:"group-key"},t}.call(void 0),t.exports=s},{"@swc/helpers/src/_class_call_check.mjs":"bcDJH","@swc/helpers/src/_create_class.mjs":"e1EPh","@swc/helpers/src/_to_consumable_array.mjs":"lp3rF","regenerator-runtime":"achxx","./parser":"2BgUG","./Events":"atGPC","./RedisConnection":"btByZ","./IORedisConnection":"7LRob","./Scripts":"9k6kW","./Bottleneck":"7ZDSs","@parcel/transformer-js/src/esmodule-helpers.js":"3ieD1"}],"6ptSl":[function(e,t,r){var n,s,i,a=e("@parcel/transformer-js/src/esmodule-helpers.js"),o=e("@swc/helpers/src/_class_call_check.mjs"),c=a.interopDefault(o),u=e("@swc/helpers/src/_create_class.mjs"),l=a.interopDefault(u);i=e("./parser"),s=e("./Events"),n=function(){var e=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};(0,c.default)(this,e),this.options=t,i.load(this.options,this.defaults,this),this.Events=new s(this),this._arr=[],this._resetPromise(),this._lastFlush=Date.now()}return(0,l.default)(e,[{key:"_resetPromise",value:function(){var e=this;return this._promise=new this.Promise((function(t,r){return e._resolve=t}))}},{key:"_flush",value:function(){return clearTimeout(this._timeout),this._lastFlush=Date.now(),this._resolve(),this.Events.trigger("batch",this._arr),this._arr=[],this._resetPromise()}},{key:"add",value:function(e){var t,r=this;return this._arr.push(e),t=this._promise,this._arr.length===this.maxSize?this._flush():null!=this.maxTime&&1===this._arr.length&&(this._timeout=setTimeout((function(){return r._flush()}),this.maxTime)),t}}]),e}();return e.prototype.defaults={maxTime:null,maxSize:null,Promise:Promise},e}.call(void 0),t.exports=n},{"@swc/helpers/src/_class_call_check.mjs":"bcDJH","@swc/helpers/src/_create_class.mjs":"e1EPh","./parser":"2BgUG","./Events":"atGPC","@parcel/transformer-js/src/esmodule-helpers.js":"3ieD1"}],"5dFWu":[function(e,t,r){var n=e("@parcel/transformer-js/src/esmodule-helpers.js");n.defineInteropFlag(r),n.export(r,"default",(function(){return _}));var s=e("@swc/helpers/src/_class_call_check.mjs"),i=n.interopDefault(s),a=e("@swc/helpers/src/_create_class.mjs"),o=n.interopDefault(a),c=e("@swc/helpers/src/_define_property.mjs"),u=n.interopDefault(c),l=e("@swc/helpers/src/_inherits.mjs"),h=n.interopDefault(l),f=e("@swc/helpers/src/_to_consumable_array.mjs"),d=n.interopDefault(f),p=e("@swc/helpers/src/_create_super.mjs"),v=n.interopDefault(p),m=e("./baseHandler"),_=function(e){"use strict";(0,h.default)(r,e);var t=(0,v.default)(r);function r(){return(0,i.default)(this,r),t.apply(this,arguments)}return(0,o.default)(r,[{key:"getItems",value:function(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];var n;return(n=this.client).getComments.apply(n,(0,d.default)(t))}},{key:"editItem",value:function(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];var n;return(n=this.client).editComment.apply(n,(0,d.default)(t))}},{key:"deleteItem",value:function(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];var n;return(n=this.client).deleteComment.apply(n,(0,d.default)(t))}}]),r}(n.interopDefault(m).default);(0,u.default)(_,"itemTextAttribute","body"),(0,u.default)(_,"itemName","Comment")},{"@swc/helpers/src/_class_call_check.mjs":"bcDJH","@swc/helpers/src/_create_class.mjs":"e1EPh","@swc/helpers/src/_define_property.mjs":"gz59H","@swc/helpers/src/_inherits.mjs":"kfOz5","@swc/helpers/src/_to_consumable_array.mjs":"lp3rF","@swc/helpers/src/_create_super.mjs":"dJHhu","./baseHandler":"lq19I","@parcel/transformer-js/src/esmodule-helpers.js":"3ieD1"}],lq19I:[function(e,t,r){var n=e("@parcel/transformer-js/src/esmodule-helpers.js");n.defineInteropFlag(r),n.export(r,"default",(function(){return j}));var s=e("@swc/helpers/src/_async_to_generator.mjs"),i=n.interopDefault(s),a=e("@swc/helpers/src/_class_call_check.mjs"),o=n.interopDefault(a),c=e("@swc/helpers/src/_class_private_field_get.mjs"),u=n.interopDefault(c),l=e("@swc/helpers/src/_class_private_field_init.mjs"),h=n.interopDefault(l),f=e("@swc/helpers/src/_class_private_method_get.mjs"),d=n.interopDefault(f),p=e("@swc/helpers/src/_class_private_method_init.mjs"),v=n.interopDefault(p),m=e("@swc/helpers/src/_create_class.mjs"),_=n.interopDefault(m),y=e("regenerator-runtime"),g=n.interopDefault(y),k=new WeakSet,b=new WeakSet,w=new WeakMap,j=function(){"use strict";function e(t,r){(0,o.default)(this,e),(0,v.default)(this,k),(0,v.default)(this,b),(0,h.default)(this,w,{get:O,set:void 0}),this.client=t,this.username=r,this.allItemsLoaded=!1}return(0,_.default)(e,[{key:"nuke",value:function(){var e=this;return(0,i.default)(g.default.mark((function t(){var r;return g.default.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!((0,u.default)(e,w).length<50)){t.next=3;break}return t.next=3,e.loadItems();case 3:if(r=(0,u.default)(e,w)[0]){t.next=7;break}return console.log("done!"),t.abrupt("return");case 7:return t.next=9,(0,d.default)(e,b,D).call(e,r);case 9:return t.abrupt("return",e.nuke());case 10:case"end":return t.stop()}}),t)})))()}},{key:"loadItems",value:function(){var e=this;return(0,i.default)(g.default.mark((function t(){return g.default.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!e.allItemsLoaded){t.next=2;break}return t.abrupt("return");case 2:return t.abrupt("return",e.getItems(e.username,{limit:"100",after:e.after},(function(t){e.after=t.data.after,e.allItemsLoaded=!e.after,(0,d.default)(e,k,x).call(e,t)})));case 3:case"end":return t.stop()}}),t)})))()}}]),e}();function x(e){var t,r=this,n=document.getElementById("items"),s=document.getElementById("item-template");e.data.children.forEach((function(e){(t=s.content.cloneNode(!0).querySelector("li")).textContent=e.data[r.constructor.itemTextAttribute],t.dataset.id=e.data.id,n.appendChild(t)}))}function D(e){return E.apply(this,arguments)}function E(){return(E=(0,i.default)(g.default.mark((function e(t){var r;return g.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=t.dataset.id,"Deleted by rnuke (https://rnuke.github.io)",t.classList.add("deleted"),e.next=5,this.editItem(r,"Deleted by rnuke (https://rnuke.github.io)");case 5:return e.next=7,this.deleteItem(r);case 7:t.addEventListener("animationend",(function(e){return e.currentTarget.remove()})),t.classList.add("slide-out");case 9:case"end":return e.stop()}}),e,this)})))).apply(this,arguments)}function O(){return document.getElementById("items").querySelectorAll("li:not(.deleted)")}},{"@swc/helpers/src/_async_to_generator.mjs":"d46FK","@swc/helpers/src/_class_call_check.mjs":"bcDJH","@swc/helpers/src/_class_private_field_get.mjs":"ax2sY","@swc/helpers/src/_class_private_field_init.mjs":"eHYn6","@swc/helpers/src/_class_private_method_get.mjs":"aKsR1","@swc/helpers/src/_class_private_method_init.mjs":"6V8Bd","@swc/helpers/src/_create_class.mjs":"e1EPh","regenerator-runtime":"achxx","@parcel/transformer-js/src/esmodule-helpers.js":"3ieD1"}],eVPMF:[function(e,t,r){var n=e("@parcel/transformer-js/src/esmodule-helpers.js");n.defineInteropFlag(r),n.export(r,"default",(function(){return _}));var s=e("@swc/helpers/src/_class_call_check.mjs"),i=n.interopDefault(s),a=e("@swc/helpers/src/_create_class.mjs"),o=n.interopDefault(a),c=e("@swc/helpers/src/_define_property.mjs"),u=n.interopDefault(c),l=e("@swc/helpers/src/_inherits.mjs"),h=n.interopDefault(l),f=e("@swc/helpers/src/_to_consumable_array.mjs"),d=n.interopDefault(f),p=e("@swc/helpers/src/_create_super.mjs"),v=n.interopDefault(p),m=e("./baseHandler"),_=function(e){"use strict";(0,h.default)(r,e);var t=(0,v.default)(r);function r(){return(0,i.default)(this,r),t.apply(this,arguments)}return(0,o.default)(r,[{key:"getItems",value:function(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];var n;return(n=this.client).getPosts.apply(n,(0,d.default)(t))}},{key:"editItem",value:function(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];var n;return(n=this.client).editPost.apply(n,(0,d.default)(t))}},{key:"deleteItem",value:function(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];var n;return(n=this.client).editPost.apply(n,(0,d.default)(t))}}]),r}(n.interopDefault(m).default);(0,u.default)(_,"itemTextAttribute","title"),(0,u.default)(_,"itemName","Post")},{"@swc/helpers/src/_class_call_check.mjs":"bcDJH","@swc/helpers/src/_create_class.mjs":"e1EPh","@swc/helpers/src/_define_property.mjs":"gz59H","@swc/helpers/src/_inherits.mjs":"kfOz5","@swc/helpers/src/_to_consumable_array.mjs":"lp3rF","@swc/helpers/src/_create_super.mjs":"dJHhu","./baseHandler":"lq19I","@parcel/transformer-js/src/esmodule-helpers.js":"3ieD1"}]},["b4ts6"],"b4ts6");
//# sourceMappingURL=main.js.map
